{"Version":{"Major":1,"Minor":31,"Release":8},"Storia":["Versione 1.31.8   22 Luglio 2022 - Tommaso Martinoli","                  - CHG: rimossa la gestione del campo SOTTOTITOLO in tutte le store procedure e rimosso campo SOTTOTITOLO dalla tabella dei titoli","Versione 1.30.8   15 Luglio 2022 - Tommaso Martinoli","                  - NEW: aggiunto campo TIPO_STAMPA alla tabella utenti","Versione 1.29.8   15 Novembre 2021 - Tommaso Martinoli","                  - CHG: modifica procedura unisci_nascondi_materia","                  - CHG: rimossi campi orario e giorno da tabella insegnamenti_docente","Versione 1.28.8   15 Novembre 2021 - Tommaso Martinoli","                  - NEW: aggiornata primary key della tabella adv_query_access per evitare accessi contemporanei di utenti con stessa ip","Versione 1.27.8   14 Ottobre 2021 - Tommaso Martinoli","                  - NEW: aggiunto campo Rivale nella tabella gruppi_case_ed","                  - NEW: aggiunte view case_editrici_amiche e case_editrici_nemiche","Versione 1.26.8   12 Ottobre 2021 - Tommaso Martinoli","                  - NEW: aggiunta tabella di correlazione province_x_gruppi_editoriali","Versione 1.25.8   30 Agosto 2021 - Tommaso Martinoli","                  - CHG: Con la procedura di importazione generica\/ex-deagostini dei titoli non vengono pi\u00f9 generati nuovi editori gestiti","Versione 1.24.8   24 Agosto 2021 - Tommaso Martinoli","                  - CHG: Con la procedura di importazione generica\/ex-deagostini dei titoli viene sovrascritto anche il nome in caso di titolo gi\u00e0 esistente","Versione 1.23.8   26 Luglio 2021 - Massimiliano Zirilli","                  - FIX: Errore nella stored procedure che aggiornava le adozioni","                  - CHG: Reinserita la procedura di cancellazione di tutte le adozioni","Versione 1.23.7   16 Luglio 2021 - Tommaso Martinoli","                  - NEW: Aggiunta store procedure di cancellazione delle adozioni e delle correlazioni istituti\/titoli, eseguita prima di un'importazione adozioni","                  - NEW: Aggiunti campi nuova_adozione,da_acquistare e consigliato alla tabella delle adozioni","                  - CHG: Modificata store procedure di importazione csv delle adozioni per salvare i dati detti sopra","Versione 1.22.7   22 Giugno 2021 - Tommaso Martinoli","                  - NEW: aggiunta tabella istituti_gruppi","                  - NEW: aggiunta tabella statistiche","                  - NEW: aggiunta tabella tipologie_gruppi_istituti","                  - NEW: aggiunta view adozioni_attuali","Versione 1.21.7   11 Giugno 2021 - Tommaso Martinoli","                  - NEW: Aggiunta store procedure clear_inventario_gruppo per azzerare solo i titoli di un editore selezionato","Versione 1.20.7   10 Giugno 2021 - Tommaso Martinoli","                  - NEW: Aggiunto campo nascosta nella tabelle materie_insegnamento","Versione 1.19.7   24 Maggio 2021 - Tommaso Martinoli","                  - NEW: Aggiunta unique key in tabella titoli per prevenire inserimento duplicati con stesso codice isbn e titolo","Versione 1.18.7   09 Marzo 2021 - Tommaso Martinoli","                  - NEW: Aggiuta colonna piattaforma_2 nella tabella docenti","Versione 1.17.7   05 Marzo 2021 - Tommaso Martinoli","                  - NEW: Introdotta store procedure per la generazione dell xls del fatturato","Versione 1.16.7   03 Marzo 2021 - Tommaso Martinoli","                  - NEW: Introdotte store procedure di insert ed update del carico","                  - CHG: Modifica del trigger di update del carico per gestione novit\u00e0","Versione 1.15.7   26 Febbraio 2021 - Tommaso Martinoli","                  - NEW: Introdotti campi prenotazione_novita e novita_caricate in tabella titoli","                  - NEW: Introdotte store procedure di insert,update e delete dei carichi per gestire le novit\u00e0 prenotate","                  - NEW: Aggiunti campi targa alle due tabelle delle province","                  - NEW: Aggiunta foreign key alla tabella province dal campo provincia della tabella docenti","Versione 1.14.7   25 Febbraio 2021 - Tommaso Martinoli","                  - CHG: Modifica procedura importazione titoli catalogo DeAgostini","                  - CHG: Eliminazione procedura importazione titoli catalogo Mondadori","Versione 1.13.7   24 Febbraio 2021 - Tommaso Martinoli","                  - NEW: Aggiunti campi url_calendario e calendario_visibile in configurazione_ditta","                  - NEW: Aggiunto campo nascosto in docenti","                  - NEW: Aggiunta tabella gruppi_case_ed","                  - NEW: Aggiunto campo gruppo in tabella case_editrici","                  - NEW: Aggiunta tabella comunicazioni","Versione 1.12.7   12 Febbraio 2021 - Tommaso Martinoli","                  - NEW: Aggiunto campo ordinamento nella tabella materie_insegnamento","                  - NEW: Aggiunto il campo ordinamento_doc nella tabella utenti","Versione 1.11.7   12 Febbraio 2021 - Tommaso Martinoli","                  - CHG: Modificata la tabella degli orari dei docenti, aggiunto il campo luogo e sostituiti i due campi precedenti da e a con il campo ora","                  - CHG: Rimossa la store procedure di per l'inserimento degli orari dei docenti","Versione 1.10.7   24 Novembre 2020 - Tommaso Martinoli","                  - NEW: Aggiunti tre campi in tabella docenti che indicano di quali materie il docente \u00e8 coordinatore","Versione 1.10.6   17 Novembre 2020 - Tommaso Martinoli","                  - NEW: Aggiunto campo email secondaria nella tabella dei docenti","Versione 1.9.6    10 Novembre 2020 - Tommaso Martinoli","                  - CHG: Modificati trigger dei carichi per la gestione dell'ubicazione ","Versione 1.9.5    06 Novembre 2020 - Tommaso Martinoli","                  - NEW: Aggiunto campo ubicazione nella tabella ordini in ingresso","Versione 1.8.5    04 Novembre 2020 - Tommaso Martinoli","                  - NEW: Aggiunta tabella dell'inventario temporaneo","                  - NEW: Aggiunte store procedure per il salvataggio istantaneo dei dati durante procedura di inventario","Versione 1.7.5    21 Ottobre 2020 - Tommaso Martinoli","                  - NEW: Aggiunto trigger before insert sulla tabella dei dettagli delle spedizioni","                  - NEW: Aggiunto trigger before update sulla tabella dei dettagli delle spedizioni","                  - NEW: Aggiunto campo ultima data di modifica in tabella dettaglio spedizioni","                  - CHG: Modificato campo Sede da bit a tinyint in tabella istituti","                  - CHG: Modificata Store Procedure di update titoli da inventario","                  - CHG: Modificato trigger after update sulla tabella ordini in ingresso","Versione 1.6.4    20 Ottobre 2020 - Tommaso Martinoli","                  - NEW: Aggiunta tabella case editrici","                  - CHG: Modificata store procedure per importazione titoli da catalogo de agostini","Versione 1.5.3    18 Ottobre 2020 - Tommaso Martinoli","                  - NEW: Aggiunta tabella adv_query","Versione 1.4.3    16 Ottobre 2020 - Tommaso Martinoli","                  - NEW: Campo combinazione in tabella classi","                  - NEW: Store procedure importazione mailchimp","                  - NEW: Tabella log mailchimp","                  - NEW: Tabella configurazioni con campo data ultima importazione mail","                  - NEW: Store Procedure update dei titoli tramite inventario ","                  - NEW: Store Procedure reset inventario","                  - FIX: Modificata store procedure importazione titoli","                  - FIX: Tutti i campi bit sostituiti con tinyint","Versione 1.3.3    01 Ottobre 2020 - Tommaso Martinoli","                  - FIX: corretto inserimento data in trigger sui magazzini controlla entrambi db","                  - FIX: corrette funzioni calcola disponibilita dei titoli","Versione 1.3.2    30 Settembre 2020 - Tommaso Martinoli","                  - NEW: Aggiunto campo nascosto a tabella istituti","                  - NEW: Aggiunta store procedure che unisce e nasconde gli istituti","                  - NEW: Aggiunte funzioni di calcolo per la disponibilita dei titoli","Versione 1.2.2    15 Settembre 2020 - Tommaso Martinoli","                  - FIX: Introdotta data attuale log movimenti","                  - NEW: Inserito campo EMAIL_ARCHIVIO nella tabella configurazione_ditta","Versione 1.1.1    14 Settembre 2020 - Tommaso Martinoli","                  - FIX: Errore trigger inserimento spedizione","Versione 1.1.0    11 Settembre 2020 - Tommaso Martinoli","                  - NEW: Aggiunta la gestione delle disponibilit\u00e0","                         Eliminati gli errore di terza forma normale","Versione 1.0.0    07 Settembre 2020 - Tommaso Martinoli","                  - Prima versione"],"ListaTabelle":[{"Nome":"advquery_access","Campi":[{"Nome":"DATA","IsNullable":false,"DataType":"timestamp","AutoIncrement":false,"Commento":"","DefaultValue":"current_timestamp()","SQLAfterAddedColumn":null},{"Nome":"IP_ADDRESS","IsNullable":false,"DataType":"varchar(255)","AutoIncrement":false,"Commento":"","DefaultValue":null,"SQLAfterAddedColumn":null},{"Nome":"SUCCESS","IsNullable":false,"DataType":"tinyint(4)","AutoIncrement":false,"Commento":"","DefaultValue":null,"SQLAfterAddedColumn":null},{"Nome":"USERNAME","IsNullable":false,"DataType":"varchar(255)","AutoIncrement":false,"Commento":"","DefaultValue":null,"SQLAfterAddedColumn":null}],"PrimaryKey":{"Campi":["DATA","IP_ADDRESS","SUCCESS","USERNAME"]},"ForeignKeys":[],"UniqueKeys":[],"Indexes":[],"Triggers":[]},{"Nome":"case_editrici_amiche","Campi":[{"Nome":"CHIAVE","IsNullable":false,"DataType":"int(11)","AutoIncrement":false,"Commento":"","DefaultValue":null,"SQLAfterAddedColumn":null},{"Nome":"DESCRIZIONE","IsNullable":true,"DataType":"varchar(255)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null}],"PrimaryKey":null,"ForeignKeys":[],"UniqueKeys":[],"Indexes":[],"Triggers":[]},{"Nome":"case_editrici_nemiche","Campi":[{"Nome":"CHIAVE","IsNullable":false,"DataType":"int(11)","AutoIncrement":false,"Commento":"","DefaultValue":null,"SQLAfterAddedColumn":null},{"Nome":"DESCRIZIONE","IsNullable":true,"DataType":"varchar(255)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null}],"PrimaryKey":null,"ForeignKeys":[],"UniqueKeys":[],"Indexes":[],"Triggers":[]},{"Nome":"classi_combinazioni","Campi":[{"Nome":"CHIAVE","IsNullable":false,"DataType":"int(11)","AutoIncrement":false,"Commento":"","DefaultValue":null,"SQLAfterAddedColumn":null},{"Nome":"DESCRIZIONE","IsNullable":true,"DataType":"varchar(255)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null}],"PrimaryKey":{"Campi":["CHIAVE"]},"ForeignKeys":[],"UniqueKeys":[],"Indexes":[],"Triggers":[]},{"Nome":"comunicazioni","Campi":[{"Nome":"CHIAVE","IsNullable":false,"DataType":"int(11)","AutoIncrement":false,"Commento":"","DefaultValue":null,"SQLAfterAddedColumn":null},{"Nome":"DATA","IsNullable":true,"DataType":"date","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"TITOLO","IsNullable":true,"DataType":"varchar(50255)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"TESTO","IsNullable":true,"DataType":"blob","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"LINK","IsNullable":true,"DataType":"mediumtext","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null}],"PrimaryKey":{"Campi":["CHIAVE"]},"ForeignKeys":[],"UniqueKeys":[],"Indexes":[],"Triggers":[]},{"Nome":"configurazione_ditta","Campi":[{"Nome":"INDIRIZZO","IsNullable":true,"DataType":"varchar(255)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"EMAIL","IsNullable":true,"DataType":"varchar(255)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"SITO_WEB","IsNullable":true,"DataType":"varchar(255)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"TELEFONO","IsNullable":true,"DataType":"varchar(255)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"EMAIL_ARCHIVIO","IsNullable":true,"DataType":"varchar(50)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"URL_CALENDARIO","IsNullable":true,"DataType":"mediumtext","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"CALENDARIO_VISIBILE","IsNullable":true,"DataType":"char(1)","AutoIncrement":false,"Commento":"","DefaultValue":"'F'","SQLAfterAddedColumn":null},{"Nome":"NR_ALUNNI","IsNullable":true,"DataType":"tinyint(4)","AutoIncrement":false,"Commento":"","DefaultValue":"20","SQLAfterAddedColumn":null}],"PrimaryKey":null,"ForeignKeys":[],"UniqueKeys":[],"Indexes":[],"Triggers":[]},{"Nome":"configurazioni","Campi":[{"Nome":"ULTIMA_IMPORTAZIONE_MAIL","IsNullable":true,"DataType":"date","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null}],"PrimaryKey":null,"ForeignKeys":[],"UniqueKeys":[],"Indexes":[],"Triggers":[]},{"Nome":"debug_sql","Campi":[{"Nome":"TESTO","IsNullable":true,"DataType":"varchar(255)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null}],"PrimaryKey":null,"ForeignKeys":[],"UniqueKeys":[],"Indexes":[],"Triggers":[]},{"Nome":"gruppi_case_ed","Campi":[{"Nome":"CHIAVE","IsNullable":false,"DataType":"int(11)","AutoIncrement":false,"Commento":"","DefaultValue":null,"SQLAfterAddedColumn":null},{"Nome":"DESCRIZIONE","IsNullable":true,"DataType":"varchar(255)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"RIVALE","IsNullable":true,"DataType":"char(1)","AutoIncrement":false,"Commento":"","DefaultValue":"'F'","SQLAfterAddedColumn":null}],"PrimaryKey":{"Campi":["CHIAVE"]},"ForeignKeys":[],"UniqueKeys":[],"Indexes":[],"Triggers":[]},{"Nome":"case_editrici","Campi":[{"Nome":"CHIAVE","IsNullable":false,"DataType":"int(11)","AutoIncrement":false,"Commento":"","DefaultValue":null,"SQLAfterAddedColumn":null},{"Nome":"DESCRIZIONE","IsNullable":true,"DataType":"varchar(255)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"GRUPPO","IsNullable":true,"DataType":"int(11)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null}],"PrimaryKey":{"Campi":["CHIAVE"]},"ForeignKeys":[{"Nome":"FK_CASE_EDITRICI_GRUPPI_CASE_ED","Campo":"GRUPPO","RefTable":"gruppi_case_ed","RefField":"CHIAVE"}],"UniqueKeys":[],"Indexes":[],"Triggers":[]},{"Nome":"gruppi_x_case_ed","Campi":[{"Nome":"CASA_ED","IsNullable":true,"DataType":"int(11)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"GRUPPO","IsNullable":true,"DataType":"int(11)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null}],"PrimaryKey":null,"ForeignKeys":[{"Nome":"FK_CASA_ED_CASE_ED","Campo":"CASA_ED","RefTable":"case_editrici","RefField":"CHIAVE"},{"Nome":"FK_GRUPPO_GRUPPI_ED","Campo":"GRUPPO","RefTable":"gruppi_case_ed","RefField":"CHIAVE"}],"UniqueKeys":[],"Indexes":[],"Triggers":[]},{"Nome":"inventario_temporaneo","Campi":[{"Nome":"CODICE","IsNullable":true,"DataType":"varchar(255)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"QUANTITA_MGZN","IsNullable":true,"DataType":"int(11)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"QUANTITA_MGZN_VOL","IsNullable":true,"DataType":"int(11)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"UBICAZIONE","IsNullable":true,"DataType":"varchar(255)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null}],"PrimaryKey":null,"ForeignKeys":[],"UniqueKeys":[{"Campi":["CODICE"],"Nome":"CODICE"}],"Indexes":[],"Triggers":[]},{"Nome":"istituti_gruppi","Campi":[{"Nome":"CHIAVE","IsNullable":false,"DataType":"int(11)","AutoIncrement":false,"Commento":"","DefaultValue":null,"SQLAfterAddedColumn":null},{"Nome":"DESCRIZIONE","IsNullable":true,"DataType":"varchar(255)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"LICEO","IsNullable":true,"DataType":"tinyint(4)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null}],"PrimaryKey":{"Campi":["CHIAVE"]},"ForeignKeys":[],"UniqueKeys":[],"Indexes":[],"Triggers":[]},{"Nome":"log_mailchimp","Campi":[{"Nome":"RAGIONE_SOCIALE","IsNullable":true,"DataType":"varchar(255)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"MAIL","IsNullable":true,"DataType":"varchar(255)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"CHIAVE_DOC","IsNullable":true,"DataType":"int(11)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"DATA","IsNullable":true,"DataType":"date","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null}],"PrimaryKey":null,"ForeignKeys":[],"UniqueKeys":[],"Indexes":[],"Triggers":[]},{"Nome":"luoghi_disponibilita","Campi":[{"Nome":"CHIAVE","IsNullable":false,"DataType":"int(11)","AutoIncrement":false,"Commento":"","DefaultValue":null,"SQLAfterAddedColumn":null},{"Nome":"DESCRIZIONE","IsNullable":true,"DataType":"varchar(255)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null}],"PrimaryKey":{"Campi":["CHIAVE"]},"ForeignKeys":[],"UniqueKeys":[],"Indexes":[],"Triggers":[]},{"Nome":"materie_insegnamento","Campi":[{"Nome":"CHIAVE","IsNullable":false,"DataType":"int(11)","AutoIncrement":false,"Commento":"","DefaultValue":null,"SQLAfterAddedColumn":null},{"Nome":"DESCRIZIONE","IsNullable":true,"DataType":"varchar(255)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"ORDINAMENTO","IsNullable":true,"DataType":"int(11)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"NASCOSTA","IsNullable":true,"DataType":"tinyint(4)","AutoIncrement":false,"Commento":"","DefaultValue":"0","SQLAfterAddedColumn":null},{"Nome":"PER_DOCENTI","IsNullable":true,"DataType":"char(1)","AutoIncrement":false,"Commento":"","DefaultValue":"'F'","SQLAfterAddedColumn":null},{"Nome":"FROM_MIUR","IsNullable":true,"DataType":"char(1)","AutoIncrement":false,"Commento":"","DefaultValue":"'F'","SQLAfterAddedColumn":null}],"PrimaryKey":{"Campi":["CHIAVE"]},"ForeignKeys":[],"UniqueKeys":[],"Indexes":[],"Triggers":[]},{"Nome":"materie_istituti","Campi":[{"Nome":"MATERIA","IsNullable":true,"DataType":"int(11)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"GRUPPO_IST","IsNullable":true,"DataType":"int(11)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null}],"PrimaryKey":null,"ForeignKeys":[{"Nome":"FK_MATERIE_ISTITUTI_ISTITUTI_GRUPPI","Campo":"GRUPPO_IST","RefTable":"istituti_gruppi","RefField":"CHIAVE"},{"Nome":"FK_MATERIE_ISTITUTI_MATERIE_INSEGNAMENTO","Campo":"MATERIA","RefTable":"materie_insegnamento","RefField":"CHIAVE"}],"UniqueKeys":[],"Indexes":[],"Triggers":[]},{"Nome":"province","Campi":[{"Nome":"CHIAVE","IsNullable":false,"DataType":"int(11)","AutoIncrement":false,"Commento":"","DefaultValue":null,"SQLAfterAddedColumn":null},{"Nome":"NOME","IsNullable":true,"DataType":"varchar(255)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"TARGA","IsNullable":true,"DataType":"varchar(2)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null}],"PrimaryKey":{"Campi":["CHIAVE"]},"ForeignKeys":[],"UniqueKeys":[],"Indexes":[],"Triggers":[]},{"Nome":"province_all","Campi":[{"Nome":"CHIAVE","IsNullable":false,"DataType":"int(11)","AutoIncrement":false,"Commento":"","DefaultValue":null,"SQLAfterAddedColumn":null},{"Nome":"NOME","IsNullable":true,"DataType":"varchar(255)","AutoIncrement":false,"Commento":"","DefaultValue":"''","SQLAfterAddedColumn":null},{"Nome":"TARGA","IsNullable":true,"DataType":"varchar(2)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null}],"PrimaryKey":{"Campi":["CHIAVE"]},"ForeignKeys":[],"UniqueKeys":[],"Indexes":[],"Triggers":[]},{"Nome":"docenti","Campi":[{"Nome":"CHIAVE","IsNullable":false,"DataType":"int(11)","AutoIncrement":false,"Commento":"","DefaultValue":null,"SQLAfterAddedColumn":null},{"Nome":"RAGIONE_SOCIALE","IsNullable":true,"DataType":"varchar(255)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"TITOLO","IsNullable":true,"DataType":"varchar(255)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"MATERIA_1","IsNullable":true,"DataType":"int(11)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"MATERIA_2","IsNullable":true,"DataType":"int(11)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"MATERIA_3","IsNullable":true,"DataType":"int(11)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"LYBRO_KEY","IsNullable":true,"DataType":"int(11)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"INDIRIZZO","IsNullable":true,"DataType":"varchar(255)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"COMUNE","IsNullable":true,"DataType":"varchar(255)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"CAP","IsNullable":true,"DataType":"varchar(255)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"PROVINCIA","IsNullable":true,"DataType":"int(11)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"PIATTAFORMA","IsNullable":true,"DataType":"char(1)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"TEL_PRIMO","IsNullable":true,"DataType":"varchar(255)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"TEL_SECONDO","IsNullable":true,"DataType":"varchar(255)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"TEL_TERZO","IsNullable":true,"DataType":"varchar(255)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"EMAIL","IsNullable":true,"DataType":"varchar(255)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"NOTE","IsNullable":true,"DataType":"text","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"EMAIL_2","IsNullable":true,"DataType":"varchar(255)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"COORD_MATERIA_1","IsNullable":true,"DataType":"int(11)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"COORD_MATERIA_2","IsNullable":true,"DataType":"int(11)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"COORD_MATERIA_3","IsNullable":true,"DataType":"int(11)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"NASCOSTO","IsNullable":true,"DataType":"char(1)","AutoIncrement":false,"Commento":"","DefaultValue":"'F'","SQLAfterAddedColumn":null},{"Nome":"PIATTAFORMA_2","IsNullable":true,"DataType":"char(1)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null}],"PrimaryKey":{"Campi":["CHIAVE"]},"ForeignKeys":[{"Nome":"FK_DOCENTI_MATERIE_INSEGAMENTO_1","Campo":"MATERIA_1","RefTable":"materie_insegnamento","RefField":"CHIAVE"},{"Nome":"FK_DOCENTI_MATERIE_INSEGAMENTO_2","Campo":"MATERIA_2","RefTable":"materie_insegnamento","RefField":"CHIAVE"},{"Nome":"FK_DOCENTI_MATERIE_INSEGAMENTO_3","Campo":"MATERIA_3","RefTable":"materie_insegnamento","RefField":"CHIAVE"},{"Nome":"FK_DOCENTI_PROVINCE_ALL","Campo":"PROVINCIA","RefTable":"province_all","RefField":"CHIAVE"}],"UniqueKeys":[],"Indexes":[],"Triggers":[]},{"Nome":"province_x_gruppi_editoriali","Campi":[{"Nome":"PROVINCIA","IsNullable":true,"DataType":"int(11)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"GRUPPO","IsNullable":true,"DataType":"int(11)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null}],"PrimaryKey":null,"ForeignKeys":[{"Nome":"FK_PROVINCE_X_GRUPPI_EDITORIALI_GRUPPI_CASE_ED","Campo":"GRUPPO","RefTable":"gruppi_case_ed","RefField":"CHIAVE"},{"Nome":"FK_PROVINCE_X_GRUPPI_EDITORIALI_PROVINCE","Campo":"PROVINCIA","RefTable":"province","RefField":"CHIAVE"}],"UniqueKeys":[],"Indexes":[],"Triggers":[]},{"Nome":"tipologie_escluse_istituto","Campi":[{"Nome":"CHIAVE","IsNullable":false,"DataType":"int(11)","AutoIncrement":false,"Commento":"","DefaultValue":null,"SQLAfterAddedColumn":null},{"Nome":"DESCRIZIONE","IsNullable":true,"DataType":"varchar(255)","AutoIncrement":false,"Commento":"","DefaultValue":"''","SQLAfterAddedColumn":null}],"PrimaryKey":{"Campi":["CHIAVE"]},"ForeignKeys":[],"UniqueKeys":[],"Indexes":[],"Triggers":[]},{"Nome":"tipologie_istituto","Campi":[{"Nome":"CHIAVE","IsNullable":false,"DataType":"int(11)","AutoIncrement":false,"Commento":"","DefaultValue":null,"SQLAfterAddedColumn":null},{"Nome":"DESCRIZIONE","IsNullable":true,"DataType":"varchar(255)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null}],"PrimaryKey":{"Campi":["CHIAVE"]},"ForeignKeys":[],"UniqueKeys":[],"Indexes":[],"Triggers":[]},{"Nome":"tipologie_gruppi_istituti","Campi":[{"Nome":"TIPOLOGIA","IsNullable":true,"DataType":"int(11)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"GRUPPO_IST","IsNullable":true,"DataType":"int(11)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null}],"PrimaryKey":null,"ForeignKeys":[{"Nome":"FK_TIPOLOGIE_GRUPPI_ISTITUTI_ISTITUTI_GRUPPI","Campo":"GRUPPO_IST","RefTable":"istituti_gruppi","RefField":"CHIAVE"},{"Nome":"FK_TIPOLOGIE_GRUPPI_ISTITUTI_TIPOLOGIE_ISTITUTO","Campo":"TIPOLOGIA","RefTable":"tipologie_istituto","RefField":"CHIAVE"}],"UniqueKeys":[],"Indexes":[],"Triggers":[]},{"Nome":"titoli","Campi":[{"Nome":"CHIAVE","IsNullable":false,"DataType":"int(11)","AutoIncrement":false,"Commento":"","DefaultValue":null,"SQLAfterAddedColumn":null},{"Nome":"CODICE_ISBN","IsNullable":true,"DataType":"varchar(255)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"TITOLO","IsNullable":true,"DataType":"varchar(255)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"MATERIA","IsNullable":true,"DataType":"int(11)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"AUTORI","IsNullable":true,"DataType":"varchar(255)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"EDITORE","IsNullable":true,"DataType":"varchar(255)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"VOLUME","IsNullable":true,"DataType":"tinyint(4)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"POS_MAGAZZINO","IsNullable":true,"DataType":"varchar(255)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"QUANTITA_MGZN","IsNullable":true,"DataType":"int(11)","AutoIncrement":false,"Commento":"","DefaultValue":"0","SQLAfterAddedColumn":null},{"Nome":"QUANTITA_MGZN_VOL","IsNullable":true,"DataType":"int(11)","AutoIncrement":false,"Commento":"","DefaultValue":"0","SQLAfterAddedColumn":null},{"Nome":"PREZZO","IsNullable":true,"DataType":"varchar(255)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"PRENOTAZ_NOVITA","IsNullable":true,"DataType":"int(11)","AutoIncrement":false,"Commento":"","DefaultValue":"0","SQLAfterAddedColumn":null},{"Nome":"NOVITA_CARICATE","IsNullable":true,"DataType":"int(11)","AutoIncrement":false,"Commento":"","DefaultValue":"0","SQLAfterAddedColumn":null}],"PrimaryKey":{"Campi":["CHIAVE"]},"ForeignKeys":[{"Nome":"FK_TITOLI_MATERIE_INSEGNAMENTO","Campo":"MATERIA","RefTable":"materie_insegnamento","RefField":"CHIAVE"}],"UniqueKeys":[{"Campi":["CODICE_ISBN"],"Nome":"TITOLO_UNIVOCO"}],"Indexes":[],"Triggers":[{"Nome":"titoli_after_insert","Event":"INSERT","Body":"BEGIN\r\n  IF NEW.QUANTITA_MGZN <> 0 THEN\r\n    INSERT INTO movimenti_magazzino (DATA,TITOLO,QUANTITA,DESCRIZIONE) VALUES (NOW(),NEW.CHIAVE,NEW.QUANTITA_MGZN,'Aggiunto nuovo titolo al magazzino');\r\n  END IF;\r\n  \r\n  IF NEW.QUANTITA_MGZN_VOL <> 0 THEN\r\n    INSERT INTO movimenti_magazzino_volante (DATA,TITOLO,QUANTITA,DESCRIZIONE) VALUES (NOW(),NEW.CHIAVE,NEW.QUANTITA_MGZN_VOL,'Aggiunto nuovo titolo al magazzino');\r\n  END IF;\r\n\r\nEND","Timing":"AFTER"},{"Nome":"titoli_after_delete","Event":"DELETE","Body":"BEGIN\r\n  \r\n  DELETE FROM movimenti_magazzino \r\n   WHERE TITOLO = OLD.CHIAVE;\r\n  DELETE FROM movimenti_magazzino_volante \r\n   WHERE TITOLO = OLD.CHIAVE;\r\n\r\nEND","Timing":"BEFORE"}]},{"Nome":"ordini_ingresso","Campi":[{"Nome":"CHIAVE","IsNullable":false,"DataType":"int(11)","AutoIncrement":false,"Commento":"","DefaultValue":null,"SQLAfterAddedColumn":null},{"Nome":"DATA","IsNullable":true,"DataType":"date","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"TITOLO","IsNullable":true,"DataType":"int(11)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"QUANTITA","IsNullable":true,"DataType":"int(11)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"UBICAZIONE","IsNullable":true,"DataType":"varchar(255)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null}],"PrimaryKey":{"Campi":["CHIAVE"]},"ForeignKeys":[{"Nome":"FK_ORDINI_INGRESSO_TITOLI","Campo":"TITOLO","RefTable":"titoli","RefField":"CHIAVE"}],"UniqueKeys":[],"Indexes":[],"Triggers":[{"Nome":"ordini_ingresso_after_insert","Event":"INSERT","Body":"BEGIN\r\n\r\n  IF NEW.UBICAZIONE IS NOT NULL THEN\r\n\t  UPDATE titoli SET POS_MAGAZZINO=NEW.UBICAZIONE \r\n\t   WHERE CHIAVE = NEW.TITOLO;\r\n  END IF;\r\n  \r\n  UPDATE titoli SET QUANTITA_MGZN=(QUANTITA_MGZN + NEW.QUANTITA)\r\n   WHERE CHIAVE = NEW.TITOLO;\r\n  INSERT INTO movimenti_magazzino (DATA,TITOLO,QUANTITA,DESCRIZIONE)VALUES(NOW(),NEW.TITOLO,NEW.QUANTITA,'Nuovo ingresso titolo');\r\n\r\nEND","Timing":"AFTER"},{"Nome":"ordini_ingresso_after_update","Event":"UPDATE","Body":"BEGIN\r\n\r\n  DECLARE OldNovitaCaricate INT;\r\n  DECLARE OldNovitaPrenotate INT;\r\n  DECLARE QuantitaNovitaToAdd INT;\r\n  \r\n  SELECT PRENOTAZ_NOVITA FROM titoli WHERE CHIAVE = OLD.TITOLO INTO OldNovitaPrenotate;\r\n  SELECT NOVITA_CARICATE FROM titoli WHERE CHIAVE = OLD.TITOLO INTO OldNovitaCaricate;\r\n  \r\n\tIF NEW.TITOLO <> OLD.TITOLO THEN\r\n      UPDATE titoli SET QUANTITA_MGZN = (QUANTITA_MGZN - OLD.QUANTITA) \r\n\t  \t WHERE CHIAVE = OLD.TITOLO;\r\n      UPDATE titoli SET QUANTITA_MGZN = (QUANTITA_MGZN + NEW.QUANTITA), POS_MAGAZZINO=NEW.UBICAZIONE \r\n\t\t WHERE CHIAVE = NEW.TITOLO;\r\n      INSERT INTO movimenti_magazzino (DATA,TITOLO,QUANTITA,DESCRIZIONE)VALUES(NOW(),NEW.TITOLO,NEW.QUANTITA,'Nuovo ingresso titolo');\r\n      INSERT INTO movimenti_magazzino (DATA,TITOLO,QUANTITA,DESCRIZIONE)VALUES(NOW(),OLD.TITOLO,(-1)*OLD.QUANTITA,'Modifica ingresso titolo');     \r\n   ELSE\r\n\t   IF (NEW.QUANTITA <> OLD.QUANTITA) OR (NEW.UBICAZIONE <> OLD.UBICAZIONE OR OLD.UBICAZIONE IS NULL) THEN  \r\n         UPDATE titoli SET POS_MAGAZZINO = NEW.UBICAZIONE,\r\n\t\t\t                  QUANTITA_MGZN = (QUANTITA_MGZN + (NEW.QUANTITA - OLD.QUANTITA)) \r\n\t\t\t WHERE CHIAVE = OLD.TITOLO;\r\n         INSERT INTO movimenti_magazzino (DATA,TITOLO,QUANTITA,DESCRIZIONE)VALUES(NOW(),OLD.TITOLO,NEW.QUANTITA,'Modifica ingresso titolo');\r\n      END IF;\r\n\t\t\r\n\t\tIF NEW.QUANTITA < OLD.QUANTITA THEN\r\n\t\t     IF NEW.QUANTITA < OldNovitaCaricate THEN\r\n\t\t\t     IF (OLD.QUANTITA - NEW.QUANTITA) <= OldNovitaCaricate THEN\r\n\t\t\t\t     UPDATE titoli SET NOVITA_CARICATE = OldNovitaCaricate - (OLD.QUANTITA - NEW.QUANTITA),PRENOTAZ_NOVITA = OldNovitaPrenotate + (OLD.QUANTITA - NEW.QUANTITA) WHERE CHIAVE = OLD.TITOLO;\r\n\t\t\t\t  ELSE UPDATE titoli SET NOVITA_CARICATE = 0, PRENOTAZ_NOVITA = OldNovitaPrenotate + OldNovitaCaricate WHERE CHIAVE = OLD.TITOLO;        \r\n\t\t\t\t  END IF;\r\n\t\t\t  END IF;\r\n\t\tELSE \t\t\r\n\t\t  IF OldNovitaPrenotate > 0 THEN\r\n\t\t     IF (NEW.QUANTITA - OLD.QUANTITA) <= OldNovitaPrenotate THEN\r\n\t\t        SET QuantitaNovitaToAdd := (NEW.QUANTITA - OLD.QUANTITA);\r\n\t\t     ELSE SET QuantitaNovitaToAdd := OldNovitaPrenotate;\r\n\t\t     END IF;\r\n\t\t     \r\n\t\t\t  UPDATE titoli SET PRENOTAZ_NOVITA = PRENOTAZ_NOVITA - QuantitaNovitaToAdd,NOVITA_CARICATE = NOVITA_CARICATE + QuantitaNovitaToAdd WHERE CHIAVE = OLD.TITOLO;\r\n\t\t  END IF;\r\n\t\t\r\n\t\tEND IF;\r\n\t\t  \r\n   END IF;\r\n\r\nEND","Timing":"AFTER"},{"Nome":"ordini_ingresso_after_delete","Event":"DELETE","Body":"BEGIN\r\n\r\n  UPDATE titoli SET QUANTITA_MGZN=(QUANTITA_MGZN - OLD.QUANTITA) \r\n   WHERE CHIAVE = OLD.TITOLO;\r\n  INSERT INTO movimenti_magazzino (DATA,TITOLO,QUANTITA,DESCRIZIONE)VALUES(NOW(),OLD.TITOLO,(-1)*OLD.QUANTITA,'Eliminazione ingresso titolo');\r\n\r\nEND","Timing":"AFTER"}]},{"Nome":"movimenti_magazzino_volante","Campi":[{"Nome":"DATA","IsNullable":true,"DataType":"date","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"TITOLO","IsNullable":true,"DataType":"int(11)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"QUANTITA","IsNullable":true,"DataType":"int(11)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"DESCRIZIONE","IsNullable":true,"DataType":"varchar(255)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null}],"PrimaryKey":null,"ForeignKeys":[{"Nome":"FK_MOVIMENTI_MAG_VOL_TITOLO","Campo":"TITOLO","RefTable":"titoli","RefField":"CHIAVE"}],"UniqueKeys":[],"Indexes":[],"Triggers":[]},{"Nome":"movimenti_magazzino","Campi":[{"Nome":"DATA","IsNullable":true,"DataType":"date","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"TITOLO","IsNullable":true,"DataType":"int(11)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"QUANTITA","IsNullable":true,"DataType":"int(11)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"DESCRIZIONE","IsNullable":true,"DataType":"varchar(255)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null}],"PrimaryKey":null,"ForeignKeys":[{"Nome":"FK_MOVIMENTI_MAG_TITOLO","Campo":"TITOLO","RefTable":"titoli","RefField":"CHIAVE"}],"UniqueKeys":[],"Indexes":[],"Triggers":[]},{"Nome":"utenti","Campi":[{"Nome":"CHIAVE","IsNullable":false,"DataType":"int(11)","AutoIncrement":false,"Commento":"","DefaultValue":null,"SQLAfterAddedColumn":null},{"Nome":"USERNAME","IsNullable":true,"DataType":"varchar(255)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"RAGIONE_SOCIALE","IsNullable":true,"DataType":"varchar(255)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"PASSWORD","IsNullable":true,"DataType":"varchar(255)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"EMAIL","IsNullable":true,"DataType":"varchar(255)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"ROLE","IsNullable":false,"DataType":"smallint(1)","AutoIncrement":false,"Commento":"","DefaultValue":"0","SQLAfterAddedColumn":null},{"Nome":"ELIMINATO","IsNullable":true,"DataType":"tinyint(4)","AutoIncrement":false,"Commento":"","DefaultValue":"0","SQLAfterAddedColumn":null},{"Nome":"ORDINAMENTO_DOC","IsNullable":true,"DataType":"char(1)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"TIPO_STAMPA","IsNullable":true,"DataType":"enum('V','N')","AutoIncrement":false,"Commento":"","DefaultValue":"'V'","SQLAfterAddedColumn":null}],"PrimaryKey":{"Campi":["CHIAVE"]},"ForeignKeys":[],"UniqueKeys":[],"Indexes":[],"Triggers":[]},{"Nome":"magazzino_volante","Campi":[{"Nome":"CHIAVE","IsNullable":false,"DataType":"int(11)","AutoIncrement":false,"Commento":"","DefaultValue":null,"SQLAfterAddedColumn":null},{"Nome":"DATA","IsNullable":true,"DataType":"date","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"PROMOTORE","IsNullable":true,"DataType":"int(11)","AutoIncrement":false,"Commento":"","DefaultValue":"0","SQLAfterAddedColumn":null}],"PrimaryKey":{"Campi":["CHIAVE"]},"ForeignKeys":[{"Nome":"FK__UTENTI","Campo":"PROMOTORE","RefTable":"utenti","RefField":"CHIAVE"}],"UniqueKeys":[],"Indexes":[],"Triggers":[]},{"Nome":"dettaglio_magazzino_volante","Campi":[{"Nome":"CHIAVE","IsNullable":false,"DataType":"int(11)","AutoIncrement":false,"Commento":"","DefaultValue":null,"SQLAfterAddedColumn":null},{"Nome":"MOVIMENTO","IsNullable":true,"DataType":"int(11)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"TITOLO","IsNullable":true,"DataType":"int(11)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"QUANTITA","IsNullable":true,"DataType":"int(11)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null}],"PrimaryKey":{"Campi":["CHIAVE"]},"ForeignKeys":[{"Nome":"FK__MAGAZZINO_VOLANTE","Campo":"MOVIMENTO","RefTable":"magazzino_volante","RefField":"CHIAVE"},{"Nome":"FK__TITOLI","Campo":"TITOLO","RefTable":"titoli","RefField":"CHIAVE"}],"UniqueKeys":[],"Indexes":[],"Triggers":[{"Nome":"dettaglio_magazzino_volante_after_insert","Event":"INSERT","Body":"BEGIN\r\n\r\n  UPDATE titoli \r\n     SET QUANTITA_MGZN = QUANTITA_MGZN - NEW.QUANTITA,\r\n\t      QUANTITA_MGZN_VOL = QUANTITA_MGZN_VOL + NEW.QUANTITA\r\n   WHERE CHIAVE = NEW.TITOLO;\r\n  INSERT INTO movimenti_magazzino_volante (DATA,TITOLO,QUANTITA,DESCRIZIONE) VALUES (NOW(),NEW.TITOLO,NEW.QUANTITA,'Titolo spostato nel magazzino volante');\r\n  INSERT INTO movimenti_magazzino (DATA,TITOLO,QUANTITA,DESCRIZIONE) VALUES (NOW(),NEW.TITOLO,(-1)*NEW.QUANTITA,'Titolo spostato nel magazzino volante');\r\n\r\nEND","Timing":"AFTER"},{"Nome":"dettaglio_magazzino_volante_after_update","Event":"UPDATE","Body":"BEGIN\r\n  IF NEW.TITOLO = OLD.TITOLO THEN\r\n    IF NEW.QUANTITA <> OLD.QUANTITA THEN\r\n\t     UPDATE titoli \r\n\t\t     SET QUANTITA_MGZN = QUANTITA_MGZN  - (NEW.QUANTITA - OLD.QUANTITA) ,\r\n\t\t         QUANTITA_MGZN_VOL = QUANTITA_MGZN_VOL + (NEW.QUANTITA - OLD.QUANTITA)\r\n\t\t  WHERE CHIAVE = NEW.TITOLO;\r\n\t\t  INSERT INTO movimenti_magazzino (DATA,TITOLO,QUANTITA,DESCRIZIONE) VALUES (NOW(),NEW.TITOLO,OLD.QUANTITA - NEW.QUANTITA,'Modifica dettaglio volante');\r\n\t\t  INSERT INTO movimenti_magazzino_volante\t(DATA,TITOLO,QUANTITA,DESCRIZIONE) VALUES (NOW(),NEW.TITOLO,NEW.QUANTITA - OLD.QUANTITA,'Modifica dettaglio volante');\r\n\tEND IF;\r\n  ELSE\r\n    UPDATE titoli\r\n       SET QUANTITA_MGZN = QUANTITA_MGZN + OLD.QUANTITA,\r\n           QUANTITA_MGZN_VOL = QUANTITA_MGZN_VOL - OLD.QUANTITA\r\n    WHERE CHIAVE = OLD.TITOLO;\r\n\t INSERT INTO movimenti_magazzino (DATA,TITOLO,QUANTITA,DESCRIZIONE) VALUES (NOW(),OLD.TITOLO,OLD.QUANTITA,'Modifica dettaglio volante');\r\n\t INSERT INTO movimenti_magazzino_volante\t(DATA,TITOLO,QUANTITA,DESCRIZIONE) VALUES (NOW(),NEW.TITOLO,(-1)*OLD.QUANTITA,'Modifica dettaglio volante');\r\n    UPDATE titoli\r\n       SET QUANTITA_MGZN = QUANTITA_MGZN - NEW.QUANTITA,\r\n           QUANTITA_MGZN_VOL = QUANTITA_MGZN_VOL + NEW.QUANTITA\r\n    WHERE CHIAVE = NEW.TITOLO;\r\n\t INSERT INTO movimenti_magazzino (DATA,TITOLO,QUANTITA,DESCRIZIONE) VALUES (NOW(),NEW.TITOLO,(-1)*NEW.QUANTITA,'Modifica dettaglio volante');\r\n\t INSERT INTO movimenti_magazzino_volante\t(DATA,TITOLO,QUANTITA,DESCRIZIONE) VALUES (NOW(),NEW.TITOLO,NEW.QUANTITA,'Modifica dettaglio volante');\r\n  END IF;\r\nEND","Timing":"AFTER"},{"Nome":"dettaglio_magazzino_volante_after_delete","Event":"DELETE","Body":"BEGIN\r\n\r\n  UPDATE titoli\r\n     SET QUANTITA_MGZN = QUANTITA_MGZN + OLD.QUANTITA,\r\n\t      QUANTITA_MGZN_VOL = QUANTITA_MGZN_VOL - OLD.QUANTITA \r\n\tWHERE CHIAVE = OLD.TITOLO;\r\n  INSERT INTO movimenti_magazzino_volante (DATA,TITOLO,QUANTITA,DESCRIZIONE) VALUES (NOW(),OLD.TITOLO,(-1)*OLD.QUANTITA,'Eliminato movimento titolo su magazzino volante');\r\n  INSERT INTO movimenti_magazzino (DATA,TITOLO,QUANTITA,DESCRIZIONE) VALUES (NOW(),OLD.TITOLO,OLD.QUANTITA,'Riaggiunta quantita titolo da magazzino volante');\r\n  \r\nEND","Timing":"AFTER"}]},{"Nome":"istituti","Campi":[{"Nome":"CHIAVE","IsNullable":false,"DataType":"int(11)","AutoIncrement":false,"Commento":"","DefaultValue":null,"SQLAfterAddedColumn":null},{"Nome":"CODICE","IsNullable":true,"DataType":"varchar(255)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"NOME","IsNullable":true,"DataType":"varchar(255)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"INDIRIZZO","IsNullable":true,"DataType":"varchar(255)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"PROVINCIA","IsNullable":true,"DataType":"int(11)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"COMUNE","IsNullable":true,"DataType":"varchar(255)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"CAP","IsNullable":true,"DataType":"varchar(5)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"EMAIL","IsNullable":true,"DataType":"varchar(255)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"PEC","IsNullable":true,"DataType":"varchar(255)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"SITO_WEB","IsNullable":true,"DataType":"varchar(255)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"SEDE","IsNullable":true,"DataType":"tinyint(4)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"REFERENTE_1","IsNullable":true,"DataType":"varchar(255)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"TELEFONO_1","IsNullable":true,"DataType":"varchar(255)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"REFERENTE_2","IsNullable":true,"DataType":"varchar(255)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"TELEFONO_2","IsNullable":true,"DataType":"varchar(255)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"REFERENTE_3","IsNullable":true,"DataType":"varchar(255)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"TELEFONO_3","IsNullable":true,"DataType":"varchar(255)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"PROMOTORE","IsNullable":true,"DataType":"int(11)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"TIPOLOGIA","IsNullable":true,"DataType":"int(11)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"PRESIDE","IsNullable":true,"DataType":"varchar(255)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"VICEPRESIDE","IsNullable":true,"DataType":"varchar(255)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"DIR_AMMNSTR","IsNullable":true,"DataType":"varchar(255)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"NASCOSTO","IsNullable":true,"DataType":"tinyint(4)","AutoIncrement":false,"Commento":"","DefaultValue":"0","SQLAfterAddedColumn":null}],"PrimaryKey":{"Campi":["CHIAVE"]},"ForeignKeys":[{"Nome":"FK_ISTITUTI_PROVINCE","Campo":"PROVINCIA","RefTable":"province","RefField":"CHIAVE"},{"Nome":"FK_ISTITUTI_TIPOLOGIE_ISTITUTO","Campo":"TIPOLOGIA","RefTable":"tipologie_istituto","RefField":"CHIAVE"},{"Nome":"FK_ISTITUTI_UTENTI","Campo":"PROMOTORE","RefTable":"utenti","RefField":"CHIAVE"}],"UniqueKeys":[],"Indexes":[],"Triggers":[]},{"Nome":"spedizioni","Campi":[{"Nome":"CHIAVE","IsNullable":false,"DataType":"int(11)","AutoIncrement":false,"Commento":"","DefaultValue":null,"SQLAfterAddedColumn":null},{"Nome":"PRESSO","IsNullable":false,"DataType":"varchar(255)","AutoIncrement":false,"Commento":"","DefaultValue":"''","SQLAfterAddedColumn":null},{"Nome":"DOCENTE","IsNullable":true,"DataType":"int(11)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"INDIRIZZO","IsNullable":true,"DataType":"varchar(255)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"COMUNE","IsNullable":true,"DataType":"varchar(255)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"CAP","IsNullable":true,"DataType":"varchar(255)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"PROVINCIA","IsNullable":true,"DataType":"int(11)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"PROMOTORE","IsNullable":true,"DataType":"int(11)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"DATA","IsNullable":true,"DataType":"date","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"ISTITUTO","IsNullable":true,"DataType":"int(11)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null}],"PrimaryKey":{"Campi":["CHIAVE"]},"ForeignKeys":[{"Nome":"FK_SPEDIZIONI_DOCENTI","Campo":"DOCENTE","RefTable":"docenti","RefField":"CHIAVE"},{"Nome":"FK_SPEDIZIONI_ISTITUTI","Campo":"ISTITUTO","RefTable":"istituti","RefField":"CHIAVE"},{"Nome":"FK_SPEDIZIONI_PROVINCE_ALL","Campo":"PROVINCIA","RefTable":"province_all","RefField":"CHIAVE"},{"Nome":"FK_SPEDIZIONI_UTENTI","Campo":"PROMOTORE","RefTable":"utenti","RefField":"CHIAVE"}],"UniqueKeys":[],"Indexes":[],"Triggers":[]},{"Nome":"dettaglio_spedizioni","Campi":[{"Nome":"CHIAVE","IsNullable":false,"DataType":"int(11)","AutoIncrement":false,"Commento":"","DefaultValue":null,"SQLAfterAddedColumn":null},{"Nome":"SPEDIZIONE","IsNullable":true,"DataType":"int(11)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"TITOLO","IsNullable":true,"DataType":"int(11)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"QUANTITA","IsNullable":true,"DataType":"tinyint(4)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"STATO","IsNullable":true,"DataType":"char(50)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"CONS_A_MANO","IsNullable":true,"DataType":"tinyint(4)","AutoIncrement":false,"Commento":"","DefaultValue":"0","SQLAfterAddedColumn":null},{"Nome":"DATA_ULTIMA_MODIFICA","IsNullable":true,"DataType":"date","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null}],"PrimaryKey":{"Campi":["CHIAVE"]},"ForeignKeys":[{"Nome":"FK_DETTAGLIO_SPEDIZIONI","Campo":"SPEDIZIONE","RefTable":"spedizioni","RefField":"CHIAVE"},{"Nome":"FK_DETTAGLIO_SPEDIZIONI_TITOLO","Campo":"TITOLO","RefTable":"titoli","RefField":"CHIAVE"}],"UniqueKeys":[],"Indexes":[],"Triggers":[{"Nome":"dettaglio_spedizioni_before_insert","Event":"INSERT","Body":"BEGIN\r\n  \r\n  IF NEW.STATO = 'C' THEN\r\n    SET NEW.CONS_A_MANO := 1;\r\n UPDATE titoli \r\n\t SET QUANTITA_MGZN_VOL = QUANTITA_MGZN_VOL - NEW.QUANTITA\r\n  WHERE CHIAVE = NEW.TITOLO;\r\n INSERT INTO movimenti_magazzino_volante (DATA,TITOLO,QUANTITA,DESCRIZIONE) VALUES (NOW(),NEW.TITOLO,(-1)*NEW.QUANTITA,'Titolo consegnato a mano, quantita titolo rimossa dal magazzino volante');\r\n   ELSE  \r\n    SET NEW.CONS_A_MANO := 0;\r\n  END IF;\r\n  \r\n  SET NEW.DATA_ULTIMA_MODIFICA = NOW();\r\n\r\nEND","Timing":"BEFORE"},{"Nome":"dettaglio_spedizioni_before_update","Event":"UPDATE","Body":"BEGIN\r\n\r\n  SET NEW.DATA_ULTIMA_MODIFICA = NOW();\r\n  \r\nEND","Timing":"BEFORE"},{"Nome":"dettaglio_spedizioni_after_update","Event":"UPDATE","Body":"BEGIN\r\n DECLARE ConsegnatoAMano TINYINT;\r\n SELECT CONS_A_MANO\r\n   FROM dettaglio_spedizioni\r\n  WHERE CHIAVE = OLD.CHIAVE\r\n   INTO ConsegnatoAMano;\r\n\r\n IF NEW.TITOLO = OLD.TITOLO THEN\r\n    IF OLD.STATO <> NEW.STATO THEN\r\n       IF OLD.STATO = 'C' THEN\r\n          IF ConsegnatoAMano = 1 THEN\r\n           UPDATE titoli\r\n              SET QUANTITA_MGZN_VOL = QUANTITA_MGZN_VOL + OLD.QUANTITA\r\n            WHERE CHIAVE = OLD.TITOLO;\r\n           INSERT INTO movimenti_magazzino_volante (DATA,TITOLO,QUANTITA,DESCRIZIONE)VALUES(NOW(),OLD.TITOLO,OLD.QUANTITA,'Spedizione');            \r\n          ELSE\r\n           UPDATE titoli\r\n              SET QUANTITA_MGZN = QUANTITA_MGZN + OLD.QUANTITA\r\n            WHERE CHIAVE = OLD.TITOLO;\r\n           INSERT INTO movimenti_magazzino (DATA,TITOLO,QUANTITA,DESCRIZIONE)VALUES(NOW(),OLD.TITOLO,OLD.QUANTITA,'Spedizione');            \r\n          END IF;\r\n       END IF;\r\n       IF NEW.STATO = 'C' THEN\r\n           UPDATE titoli\r\n              SET QUANTITA_MGZN = QUANTITA_MGZN - NEW.QUANTITA\r\n            WHERE CHIAVE = NEW.TITOLO;\r\n           INSERT INTO movimenti_magazzino (DATA,TITOLO,QUANTITA,DESCRIZIONE)VALUES(NOW(),NEW.TITOLO,(-1)*NEW.QUANTITA,'Spedizione');            \r\n       END IF;\r\n    ELSE\r\n      IF (NEW.QUANTITA <> OLD.QUANTITA) AND (NEW.STATO = 'C') THEN\r\n         IF ConsegnatoAMano = 1 THEN\r\n           UPDATE titoli\r\n              SET QUANTITA_MGZN_VOL = QUANTITA_MGZN_VOL + (OLD.QUANTITA - NEW.QUANTITA)\r\n            WHERE CHIAVE = OLD.TITOLO;\r\n           INSERT INTO movimenti_magazzino_volante (DATA,TITOLO,QUANTITA,DESCRIZIONE)VALUES(NOW(),OLD.TITOLO,OLD.QUANTITA - NEW.QUANTITA,'Spedizione');            \r\n         ELSE\r\n           UPDATE titoli\r\n              SET QUANTITA_MGZN = QUANTITA_MGZN + (OLD.QUANTITA - NEW.QUANTITA)\r\n            WHERE CHIAVE = OLD.TITOLO;\r\n           INSERT INTO movimenti_magazzino (DATA,TITOLO,QUANTITA,DESCRIZIONE)VALUES(NOW(),OLD.TITOLO,OLD.QUANTITA - NEW.QUANTITA,'Spedizione');            \r\n\t\t\tEND IF;\r\n      END IF;\r\n\t END IF;\r\n ELSE\r\n    IF OLD.STATO <> NEW.STATO THEN\r\n       IF OLD.STATO = 'C' THEN\r\n          IF ConsegnatoAMano = 1 THEN\r\n           UPDATE titoli\r\n              SET QUANTITA_MGZN_VOL = QUANTITA_MGZN_VOL + OLD.QUANTITA\r\n            WHERE CHIAVE = OLD.TITOLO;\r\n           INSERT INTO movimenti_magazzino_volante (DATA,TITOLO,QUANTITA,DESCRIZIONE)VALUES(NOW(),OLD.TITOLO,OLD.QUANTITA,'Spedizione');            \r\n          ELSE\r\n           UPDATE titoli\r\n              SET QUANTITA_MGZN = QUANTITA_MGZN + OLD.QUANTITA\r\n            WHERE CHIAVE = OLD.TITOLO;\r\n           INSERT INTO movimenti_magazzino (DATA,TITOLO,QUANTITA,DESCRIZIONE)VALUES(NOW(),OLD.TITOLO,OLD.QUANTITA,'Spedizione');            \r\n          END IF;\r\n       END IF;\r\n       IF NEW.STATO = 'C' THEN\r\n           UPDATE titoli\r\n              SET QUANTITA_MGZN = QUANTITA_MGZN - NEW.QUANTITA\r\n            WHERE CHIAVE = NEW.TITOLO;\r\n           INSERT INTO movimenti_magazzino (DATA,TITOLO,QUANTITA,DESCRIZIONE)VALUES(NOW(),NEW.TITOLO,(-1)*NEW.QUANTITA,'Spedizione');            \r\n       END IF;\r\n    ELSE\r\n      IF NEW.STATO = 'C' THEN\r\n         IF ConsegnatoAMano = 1 THEN\r\n           UPDATE titoli\r\n              SET QUANTITA_MGZN_VOL = QUANTITA_MGZN_VOL + OLD.QUANTITA\r\n            WHERE CHIAVE = OLD.TITOLO;\r\n           INSERT INTO movimenti_magazzino_volante (DATA,TITOLO,QUANTITA,DESCRIZIONE)VALUES(NOW(),OLD.TITOLO,OLD.QUANTITA,'Spedizione');            \r\n           UPDATE titoli\r\n              SET QUANTITA_MGZN_VOL = QUANTITA_MGZN_VOL - NEW.QUANTITA\r\n            WHERE CHIAVE = NEW.TITOLO;\r\n           INSERT INTO movimenti_magazzino_volante (DATA,TITOLO,QUANTITA,DESCRIZIONE)VALUES(NOW(),NEW.TITOLO,(-1)*NEW.QUANTITA,'Spedizione');            \r\n         ELSE\r\n           UPDATE titoli\r\n              SET QUANTITA_MGZN = QUANTITA_MGZN + OLD.QUANTITA\r\n            WHERE CHIAVE = OLD.TITOLO;\r\n           INSERT INTO movimenti_magazzino (DATA,TITOLO,QUANTITA,DESCRIZIONE)VALUES(NOW(),OLD.TITOLO,OLD.QUANTITA,'Spedizione');            \r\n           UPDATE titoli\r\n              SET QUANTITA_MGZN = QUANTITA_MGZN - NEW.QUANTITA\r\n            WHERE CHIAVE = NEW.TITOLO;\r\n           INSERT INTO movimenti_magazzino(DATA,TITOLO,QUANTITA,DESCRIZIONE)VALUES(NOW(),NEW.TITOLO,(-1)*NEW.QUANTITA,'Spedizione');            \r\n\t\t\tEND IF;\r\n      END IF;\r\n\t END IF;\r\n END IF;\r\nEND","Timing":"AFTER"},{"Nome":"dettaglio_spedizioni_after_delete","Event":"DELETE","Body":"BEGIN\r\n  \r\n  IF OLD.STATO = 'C' THEN\r\n     IF OLD.CONS_A_MANO = 1 THEN\r\n        UPDATE titoli \r\n\t\t     SET QUANTITA_MGZN_VOL = QUANTITA_MGZN_VOL + QUANTITA_MGZN_VOL \r\n\t\t\tWHERE CHIAVE = OLD.TITOLO;\r\n        INSERT INTO movimenti_magazzino_volante (DATA,TITOLO,QUANTITA,DESCRIZIONE) VALUES (NOW(),OLD.TITOLO,OLD.QUANTITA,'Dettaglio spedizione eliminato, quantita titolo riaggiunta al magazzino volante');\r\n     ELSE\r\n        UPDATE titoli SET QUANTITA_MGZN = QUANTITA_MGZN + OLD.QUANTITA WHERE CHIAVE = OLD.TITOLO;\r\n        INSERT INTO movimenti_magazzino (DATA,TITOLO,QUANTITA,DESCRIZIONE) VALUES (NOW(),OLD.TITOLO,OLD.QUANTITA,'Dettaglio spedizione eliminato, quantita titolo riaggiunta al magazzino');\r\n     END IF;\r\n  END IF;\r\n\r\nEND","Timing":"AFTER"}]},{"Nome":"istituti_x_titoli","Campi":[{"Nome":"TITOLO","IsNullable":false,"DataType":"int(11)","AutoIncrement":false,"Commento":"","DefaultValue":null,"SQLAfterAddedColumn":null},{"Nome":"ISTITUTO","IsNullable":false,"DataType":"int(11)","AutoIncrement":false,"Commento":"","DefaultValue":null,"SQLAfterAddedColumn":null}],"PrimaryKey":{"Campi":["TITOLO","ISTITUTO"]},"ForeignKeys":[{"Nome":"FK_ISTITUTI","Campo":"ISTITUTO","RefTable":"istituti","RefField":"CHIAVE"},{"Nome":"FK_TITOLI","Campo":"TITOLO","RefTable":"titoli","RefField":"CHIAVE"}],"UniqueKeys":[],"Indexes":[],"Triggers":[]},{"Nome":"statistiche","Campi":[{"Nome":"TITOLO","IsNullable":true,"DataType":"int(11)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"ISTITUTO","IsNullable":true,"DataType":"int(11)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"NR_CLASSI","IsNullable":true,"DataType":"int(11)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"DATA","IsNullable":true,"DataType":"date","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null}],"PrimaryKey":null,"ForeignKeys":[{"Nome":"FK_STATISTICHE_ISTITUTI","Campo":"ISTITUTO","RefTable":"istituti","RefField":"CHIAVE"},{"Nome":"FK_STATISTICHE_TITOLI","Campo":"TITOLO","RefTable":"titoli","RefField":"CHIAVE"}],"UniqueKeys":[],"Indexes":[],"Triggers":[]},{"Nome":"docenti_disponibilita","Campi":[{"Nome":"DOCENTE","IsNullable":false,"DataType":"int(11)","AutoIncrement":false,"Commento":"","DefaultValue":null,"SQLAfterAddedColumn":null},{"Nome":"ISTITUTO","IsNullable":false,"DataType":"int(11)","AutoIncrement":false,"Commento":"","DefaultValue":"0","SQLAfterAddedColumn":null},{"Nome":"GIORNO","IsNullable":false,"DataType":"smallint(6)","AutoIncrement":false,"Commento":"","DefaultValue":"0","SQLAfterAddedColumn":null},{"Nome":"LUOGO","IsNullable":false,"DataType":"int(11)","AutoIncrement":false,"Commento":"","DefaultValue":"0","SQLAfterAddedColumn":null},{"Nome":"ORA","IsNullable":false,"DataType":"smallint(6)","AutoIncrement":false,"Commento":"","DefaultValue":"0","SQLAfterAddedColumn":null}],"PrimaryKey":{"Campi":["DOCENTE","ISTITUTO","GIORNO","LUOGO","ORA"]},"ForeignKeys":[{"Nome":"FK_docenti_disponibilita_docenti","Campo":"DOCENTE","RefTable":"docenti","RefField":"CHIAVE"},{"Nome":"FK_docenti_disponibilita_istituti","Campo":"ISTITUTO","RefTable":"istituti","RefField":"CHIAVE"},{"Nome":"FK_docenti_disponibilita_orari_disponibilita","Campo":"LUOGO","RefTable":"luoghi_disponibilita","RefField":"CHIAVE"}],"UniqueKeys":[],"Indexes":[],"Triggers":[]},{"Nome":"istituti_x_docenti","Campi":[{"Nome":"DOCENTE","IsNullable":false,"DataType":"int(11)","AutoIncrement":false,"Commento":"","DefaultValue":null,"SQLAfterAddedColumn":null},{"Nome":"ISTITUTO","IsNullable":false,"DataType":"int(11)","AutoIncrement":false,"Commento":"","DefaultValue":null,"SQLAfterAddedColumn":null}],"PrimaryKey":{"Campi":["DOCENTE","ISTITUTO"]},"ForeignKeys":[{"Nome":"FK__DOCENTI","Campo":"DOCENTE","RefTable":"docenti","RefField":"CHIAVE"},{"Nome":"FK__ISTITUTI","Campo":"ISTITUTO","RefTable":"istituti","RefField":"CHIAVE"}],"UniqueKeys":[],"Indexes":[],"Triggers":[]},{"Nome":"classi","Campi":[{"Nome":"CHIAVE","IsNullable":false,"DataType":"int(11)","AutoIncrement":false,"Commento":"","DefaultValue":null,"SQLAfterAddedColumn":null},{"Nome":"ANNO","IsNullable":true,"DataType":"varchar(255)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"SEZIONE","IsNullable":true,"DataType":"varchar(255)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"ISTITUTO","IsNullable":true,"DataType":"int(11)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"COMBINAZIONE","IsNullable":true,"DataType":"int(11)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null}],"PrimaryKey":{"Campi":["CHIAVE"]},"ForeignKeys":[{"Nome":"FK_CLASSI_COMBINAZIONE","Campo":"COMBINAZIONE","RefTable":"classi_combinazioni","RefField":"CHIAVE"},{"Nome":"FK_CLASSI_ISTITUTO","Campo":"ISTITUTO","RefTable":"istituti","RefField":"CHIAVE"}],"UniqueKeys":[],"Indexes":[],"Triggers":[]},{"Nome":"adozioni_titolo","Campi":[{"Nome":"CHIAVE","IsNullable":false,"DataType":"int(11)","AutoIncrement":false,"Commento":"","DefaultValue":null,"SQLAfterAddedColumn":null},{"Nome":"TITOLO","IsNullable":true,"DataType":"int(11)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"CLASSE","IsNullable":true,"DataType":"int(11)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"NUOVA_ADOZIONE","IsNullable":true,"DataType":"int(11)","AutoIncrement":false,"Commento":"","DefaultValue":"0","SQLAfterAddedColumn":null},{"Nome":"DA_ACQUISTARE","IsNullable":true,"DataType":"int(11)","AutoIncrement":false,"Commento":"","DefaultValue":"0","SQLAfterAddedColumn":null},{"Nome":"CONSIGLIATO","IsNullable":true,"DataType":"int(11)","AutoIncrement":false,"Commento":"","DefaultValue":"0","SQLAfterAddedColumn":null}],"PrimaryKey":{"Campi":["CHIAVE"]},"ForeignKeys":[{"Nome":"FK_ADOZIONI_TITOLO_CLASSI","Campo":"CLASSE","RefTable":"classi","RefField":"CHIAVE"},{"Nome":"FK_ADOZIONI_TITOLO_TITOLI","Campo":"TITOLO","RefTable":"titoli","RefField":"CHIAVE"}],"UniqueKeys":[],"Indexes":[],"Triggers":[]},{"Nome":"insegnamenti_docente","Campi":[{"Nome":"CHIAVE","IsNullable":false,"DataType":"int(11)","AutoIncrement":false,"Commento":"","DefaultValue":null,"SQLAfterAddedColumn":null},{"Nome":"MATERIA","IsNullable":true,"DataType":"int(11)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"CLASSE","IsNullable":true,"DataType":"int(11)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null},{"Nome":"DOCENTE","IsNullable":true,"DataType":"int(11)","AutoIncrement":false,"Commento":"","DefaultValue":"NULL","SQLAfterAddedColumn":null}],"PrimaryKey":{"Campi":["CHIAVE"]},"ForeignKeys":[{"Nome":"FK_INS_DOCENTI_CLASSE","Campo":"CLASSE","RefTable":"classi","RefField":"CHIAVE"},{"Nome":"FK_INS_DOCENTI_MATERIA","Campo":"MATERIA","RefTable":"materie_insegnamento","RefField":"CHIAVE"}],"UniqueKeys":[],"Indexes":[],"Triggers":[]}],"ListaGeneratori":[{"Nome":"gen_key","CampoGeneratore":"CHIAVE"}],"ListaProcedure":[{"Nome":"AGGIORNA_ISTITUTO","Type":"PROCEDURE","ReturnType":null,"Body":"BEGIN\r\n  DECLARE NewKey INT;\r\n  DECLARE KeyTipologia INT;\r\n  SELECT MAX(CHIAVE)\r\n    FROM tipologie_istituto \r\n\tWHERE UPPER(DESCRIZIONE) = DescrizioneTipologia \r\n\t INTO KeyTipologia;\r\n  \r\n  IF KeyTipologia IS NULL THEN\r\n   UPDATE gen_key SET CHIAVE = CHIAVE + 1;\r\n   SELECT MAX(CHIAVE) FROM gen_key INTO KeyTipologia; \r\n   INSERT INTO tipologie_istituto (CHIAVE,DESCRIZIONE) VALUES (KeyTipologia,DescrizioneTipologia);\r\n  END IF;\r\n  \r\n  IF (SELECT count(*) FROM istituti WHERE CODICE = CodiceIstituto) > 0 THEN\r\n    UPDATE istituti SET NOME = NomeIstituto, INDIRIZZO = IndirizzoIstituto, PROVINCIA = ProvinciaIstituto, COMUNE = ComuneIstituto, CAP = CapIstituto, EMAIL = EmailIstituto, PEC = PecIstituto, SITO_WEB = SitoWebIstituto, SEDE = SedeIstituto WHERE CODICE = CodiceIstituto;\r\n  ELSE\r\n   UPDATE gen_key SET CHIAVE = CHIAVE + 1;\r\n   SELECT MAX(CHIAVE) FROM gen_key INTO NewKey; \r\n   INSERT INTO istituti (CHIAVE,CODICE,NOME,INDIRIZZO,PROVINCIA,COMUNE,CAP,EMAIL,PEC,SITO_WEB,SEDE,TIPOLOGIA) VALUES (NewKey,CodiceIstituto,NomeIstituto,IndirizzoIstituto,ProvinciaIstituto,ComuneIstituto,CapIstituto,EmailIstituto,PecIstituto,SitoWebIstituto,SedeIstituto,KeyTipologia);\r\n  END IF;\r\nEND","Parametri":[{"Nome":"CodiceIstituto","Mode":"IN","Type":"varchar(255)"},{"Nome":"NomeIstituto","Mode":"IN","Type":"varchar(255)"},{"Nome":"IndirizzoIstituto","Mode":"IN","Type":"varchar(255)"},{"Nome":"ProvinciaIstituto","Mode":"IN","Type":"varchar(255)"},{"Nome":"ComuneIstituto","Mode":"IN","Type":"varchar(255)"},{"Nome":"CapIstituto","Mode":"IN","Type":"varchar(255)"},{"Nome":"EmailIstituto","Mode":"IN","Type":"varchar(255)"},{"Nome":"PecIstituto","Mode":"IN","Type":"varchar(255)"},{"Nome":"SitoWebIstituto","Mode":"IN","Type":"varchar(255)"},{"Nome":"SedeIstituto","Mode":"IN","Type":"bit(1)"},{"Nome":"DescrizioneTipologia","Mode":"IN","Type":"varchar(255)"}]},{"Nome":"AGGIORNA_TITOLI_ADOZIONI","Type":"PROCEDURE","ReturnType":null,"Body":"BEGIN\r\n  DECLARE NewKey INT;\r\n  DECLARE KeyMateria INT;\r\n  DECLARE KeyClasse INT;\r\n  DECLARE KeyAdozione INT;\r\n  DECLARE KeyIstituto INT;\r\n  DECLARE KeyCombinazione INT;\r\n  \r\n  SELECT MAX(CHIAVE)\r\n    FROM materie_insegnamento \r\n\tWHERE UPPER(DESCRIZIONE) = DescrizioneMateria \r\n\t INTO KeyMateria;\r\n  \r\n  IF KeyMateria IS NULL THEN\r\n     UPDATE gen_key SET CHIAVE = CHIAVE + 1;\r\n     SELECT MAX(CHIAVE) FROM gen_key INTO KeyMateria; \r\n     INSERT INTO materie_insegnamento(CHIAVE,DESCRIZIONE,FROM_MIUR) VALUES (KeyMateria,DescrizioneMateria,'T');\r\n  ELSE\r\n     UPDATE materie_insegnamento SET FROM_MIUR = 'T' WHERE CHIAVE = KeyMateria;\r\n  END IF;\r\n  \r\n  SELECT MAX(CHIAVE) \r\n    FROM classi_combinazioni\r\n   WHERE UPPER(DESCRIZIONE) = DescrizioneCombinazione\r\n    INTO KeyCombinazione;\r\n    \r\n  IF KeyCombinazione IS NULL THEN\r\n     UPDATE gen_key SET CHIAVE = CHIAVE + 1;\r\n     SELECT MAX(CHIAVE) FROM gen_key INTO KeyCombinazione;\r\n     INSERT INTO classi_combinazioni(CHIAVE,DESCRIZIONE)VALUES(KeyCombinazione,DescrizioneCombinazione);\r\n  END IF;\r\n  \r\n  IF (SELECT count(*) FROM titoli WHERE CODICE_ISBN = CodiceTitolo) > 0 THEN\r\n      UPDATE titoli \r\n\t\t   SET TITOLO = TitoloTitolo, AUTORI = AutoriTitolo, EDITORE = EditoreTitolo, VOLUME = VolumeTitolo, PREZZO = PrezzoTitolo, MATERIA = KeyMateria\r\n\t\t WHERE CODICE_ISBN = CodiceTitolo;\r\n  ELSE\r\n      UPDATE gen_key SET CHIAVE = CHIAVE + 1;\r\n      SELECT MAX(CHIAVE) FROM gen_key INTO NewKey; \r\n      INSERT INTO titoli (CHIAVE,CODICE_ISBN,TITOLO,AUTORI,EDITORE,VOLUME,MATERIA,PREZZO) VALUES (NewKey,CodiceTitolo,TitoloTitolo,AutoriTitolo,EditoreTitolo,VolumeTitolo,KeyMateria,PrezzoTitolo);\r\n  END IF;\r\n  \r\n  SELECT istituti.CHIAVE \r\n    FROM istituti \r\n\tWHERE istituti.CODICE = IstitutoTitolo \r\n   LIMIT 1 \r\n\t INTO KeyIstituto; \r\n\t \r\n   IF KeyIstituto IS NOT NULL THEN\r\n      INSERT IGNORE INTO istituti_x_titoli (TITOLO,ISTITUTO) VALUES ((SELECT titoli.CHIAVE FROM titoli WHERE CODICE_ISBN = CodiceTitolo),KeyIstituto); \r\n      \r\n\t\tSELECT MAX(CHIAVE)\r\n \t\t  FROM classi \r\n\t\tWHERE UPPER(ANNO) = AnnoTitolo AND UPPER(SEZIONE) = SezioneTitolo AND ISTITUTO = KeyIstituto AND COMBINAZIONE = KeyCombinazione\r\n \t\t INTO KeyClasse;\r\n\t\t\r\n\t\tIF KeyClasse IS NULL THEN\r\n\t\t  UPDATE gen_key \r\n\t\t    SET CHIAVE = CHIAVE + 1;\r\n\t\t  SELECT MAX(CHIAVE) FROM gen_key INTO KeyClasse; \r\n\t\t  INSERT INTO classi (CHIAVE,ANNO,SEZIONE,ISTITUTO,COMBINAZIONE) VALUES (KeyClasse,AnnoTitolo,SezioneTitolo,KeyIstituto,KeyCombinazione);\r\n\t\tEND IF;\r\n\t\t\r\n\t\tSELECT MAX(CHIAVE)\r\n\t\t  FROM adozioni_titolo\r\n\t\t WHERE TITOLO = (SELECT titoli.CHIAVE FROM titoli WHERE CODICE_ISBN = CodiceTitolo) AND CLASSE = KeyClasse\r\n\t\t  INTO KeyAdozione;\r\n\t\t\r\n\t\tIF KeyAdozione IS NULL THEN\r\n\t\t  UPDATE gen_key \r\n\t\t    SET CHIAVE = CHIAVE + 1;\r\n\t\t  SELECT MAX(CHIAVE) FROM gen_key INTO KeyAdozione; \r\n\t\t  INSERT INTO adozioni_titolo (CHIAVE,TITOLO,CLASSE,NUOVA_ADOZIONE,DA_ACQUISTARE,CONSIGLIATO) VALUES (KeyAdozione,(SELECT titoli.CHIAVE FROM titoli WHERE CODICE_ISBN = CodiceTitolo),KeyClasse,NuovaAdozioneTitolo,DaAcquistareTitolo,ConsigliatoTitolo);\r\n\t\tELSE\r\n\t\t  UPDATE adozioni_titolo SET DA_ACQUISTARE = DaAcquistareTitolo,CONSIGLIATO = ConsigliatoTitolo,NUOVA_ADOZIONE = NuovaAdozioneTitolo WHERE CHIAVE = KeyAdozione;\r\n\t   END IF;\r\n\tEND IF;\r\n  \r\nEND","Parametri":[{"Nome":"CodiceTitolo","Mode":"IN","Type":"varchar(255)"},{"Nome":"TitoloTitolo","Mode":"IN","Type":"varchar(255)"},{"Nome":"AutoriTitolo","Mode":"IN","Type":"varchar(255)"},{"Nome":"EditoreTitolo","Mode":"IN","Type":"varchar(255)"},{"Nome":"VolumeTitolo","Mode":"IN","Type":"tinyint(4)"},{"Nome":"DescrizioneMateria","Mode":"IN","Type":"varchar(255)"},{"Nome":"IstitutoTitolo","Mode":"IN","Type":"varchar(255)"},{"Nome":"AnnoTitolo","Mode":"IN","Type":"varchar(255)"},{"Nome":"SezioneTitolo","Mode":"IN","Type":"varchar(255)"},{"Nome":"DescrizioneCombinazione","Mode":"IN","Type":"varchar(255)"},{"Nome":"PrezzoTitolo","Mode":"IN","Type":"varchar(255)"},{"Nome":"NuovaAdozioneTitolo","Mode":"IN","Type":"int(11)"},{"Nome":"DaAcquistareTitolo","Mode":"IN","Type":"int(11)"},{"Nome":"ConsigliatoTitolo","Mode":"IN","Type":"int(11)"}]},{"Nome":"AGGIORNA_TITOLI_FROM_CATALOGHI_DEAGOSTINI","Type":"PROCEDURE","ReturnType":null,"Body":"BEGIN\r\n\r\n  DECLARE NewKey INT;\r\n  DECLARE KeyMateria INT;\r\n  DECLARE KeyEditore INT;\r\n\r\n  SELECT MAX(CHIAVE)\r\n    FROM materie_insegnamento \r\n\tWHERE UPPER(DESCRIZIONE) = MateriaTitolo \r\n\t INTO KeyMateria;\r\n  \r\n  IF KeyMateria IS NULL THEN\r\n\t  UPDATE gen_key SET CHIAVE = CHIAVE + 1;\r\n\t  SELECT MAX(CHIAVE) FROM gen_key INTO KeyMateria; \r\n     INSERT INTO materie_insegnamento(CHIAVE,DESCRIZIONE) VALUES (KeyMateria,MateriaTitolo);\r\n  END IF;\r\n  \r\n  SELECT MAX(CHIAVE)\r\n    FROM  case_editrici \r\n   WHERE UPPER(DESCRIZIONE) = EditoreTitolo  \r\n    INTO KeyEditore;\r\n  \r\n  IF KeyEditore IS NULL THEN\r\n     UPDATE gen_key SET CHIAVE = CHIAVE + 1;\r\n     SELECT MAX(CHIAVE) FROM gen_key INTO KeyEditore; \r\n     INSERT INTO case_editrici(CHIAVE,DESCRIZIONE) VALUES (KeyEditore,EditoreTitolo);\r\n  END IF;\r\n  \r\n  IF (SELECT count(*) FROM titoli WHERE CODICE_ISBN = CodiceTitolo) > 0 THEN\r\n      UPDATE titoli \r\n\t\t   SET TITOLO = TitoloTitolo, EDITORE = EditoreTitolo, PREZZO = PrezzoTitolo, VOLUME = VolumeTitolo \r\n\t\t WHERE CODICE_ISBN = CodiceTitolo;\r\n  ELSE\r\n      UPDATE gen_key SET CHIAVE = CHIAVE + 1;\r\n      SELECT MAX(CHIAVE) FROM gen_key INTO NewKey; \r\n      INSERT INTO titoli (CHIAVE,CODICE_ISBN,TITOLO,AUTORI,EDITORE,MATERIA,VOLUME,PREZZO) VALUES (NewKey,CodiceTitolo,TitoloTitolo,AutoreTitolo,EditoreTitolo,KeyMateria,VolumeTitolo,PrezzoTitolo);\r\n  END IF;\r\n\t  \r\nEND","Parametri":[{"Nome":"CodiceTitolo","Mode":"IN","Type":"varchar(255)"},{"Nome":"TitoloTitolo","Mode":"IN","Type":"varchar(255)"},{"Nome":"MateriaTitolo","Mode":"IN","Type":"varchar(255)"},{"Nome":"EditoreTitolo","Mode":"IN","Type":"varchar(255)"},{"Nome":"AutoreTitolo","Mode":"IN","Type":"varchar(255)"},{"Nome":"VolumeTitolo","Mode":"IN","Type":"tinyint(4)"},{"Nome":"PrezzoTitolo","Mode":"IN","Type":"varchar(255)"}]},{"Nome":"CALCOLA_DISPONIBILITA","Type":"FUNCTION","ReturnType":"int(11)","Body":"BEGIN\r\n\r\n  DECLARE QuantitaMagazzino INT;\r\n  DECLARE QuantitaDaSpedire INT;\r\n  \r\n  SELECT titoli.QUANTITA_MGZN FROM titoli WHERE CHIAVE = ChiaveTitolo INTO QuantitaMagazzino;\r\n  SELECT SUM(QUANTITA) FROM dettaglio_spedizioni WHERE dettaglio_spedizioni.STATO = 'S' AND dettaglio_spedizioni.TITOLO = ChiaveTitolo INTO QuantitaDaSpedire;\r\n  \r\n  IF QuantitaDaSpedire IS NULL THEN\r\n     SET QuantitaDaSpedire = 0;\r\n  END IF;\r\n  IF QuantitaMagazzino - QuantitaDaSpedire > 0 THEN RETURN 1;\r\n  ELSE RETURN 0;\r\n  END IF; \r\n  \r\nEND","Parametri":[{"Nome":"ChiaveTitolo","Mode":"IN","Type":"int(11)"}]},{"Nome":"CALCOLA_DISPONIBILITA_ALL","Type":"FUNCTION","ReturnType":"int(11)","Body":"BEGIN\r\n\r\n  DECLARE QuantitaMagazzino INT;\r\n  DECLARE QuantitaDaSpedire INT;\r\n  \r\n  SELECT titoli.QUANTITA_MGZN FROM titoli WHERE CHIAVE = ChiaveTitolo INTO QuantitaMagazzino;\r\n  SELECT SUM(QUANTITA) FROM dettaglio_spedizioni WHERE dettaglio_spedizioni.STATO = 'S' AND dettaglio_spedizioni.TITOLO = ChiaveTitolo INTO QuantitaDaSpedire;\r\n  \r\n  IF QuantitaDaSpedire IS NULL THEN\r\n     SET QuantitaDaSpedire = 0;\r\n  END IF;\r\n  IF QuantitaMagazzino > QuantitaDaSpedire THEN \r\n     RETURN QuantitaMagazzino - QuantitaDaSpedire;\r\n  ELSE \r\n     RETURN 0;\r\n  END IF; \r\n  \r\nEND","Parametri":[{"Nome":"ChiaveTitolo","Mode":"IN","Type":"int(11)"}]},{"Nome":"CLEAR_INVENTARIO_ALL","Type":"PROCEDURE","ReturnType":null,"Body":"BEGIN\r\n\r\n\tDECLARE CicloFinito INTEGER DEFAULT 0;\r\n\tDECLARE ChiaveTitolo INT;\r\n\tDECLARE OldQuantita INT;\r\n\tDECLARE OldQuantitaVol INT;\r\n\r\n\tDEClARE CursoreTitoli \r\n\t\tCURSOR FOR \r\n\t\t\tSELECT CHIAVE,QUANTITA_MGZN,QUANTITA_MGZN_VOL FROM titoli WHERE QUANTITA_MGZN <> 0 OR QUANTITA_MGZN_VOL <> 0;\r\n\r\n\tDECLARE CONTINUE HANDLER \r\n        FOR NOT FOUND SET CicloFinito = 1;\r\n\r\n\tOPEN CursoreTitoli;\r\n\r\n\tGetTitoli: LOOP\r\n\t\tFETCH CursoreTitoli INTO ChiaveTitolo,OldQuantita,OldQuantitaVol;\r\n\t\tIF CicloFinito = 1 THEN \r\n\t\t\tLEAVE GetTitoli;\r\n\t\tEND IF;\r\n\t\t\r\n\t   IF OldQuantita <> 0 AND OldQuantitaVol = 0 THEN\r\n\t\t   UPDATE titoli SET QUANTITA_MGZN = 0  WHERE CHIAVE = ChiaveTitolo;\r\n\t\t   INSERT INTO movimenti_magazzino (DATA,TITOLO,QUANTITA,DESCRIZIONE)VALUES(NOW(),ChiaveTitolo,0,'Quantita azzerata da reset inventario');\r\n      END IF;\r\n\t   IF OldQuantita = 0 AND OldQuantitaVol <> 0 THEN\r\n\t      UPDATE titoli SET QUANTITA_MGZN_VOL = 0  WHERE CHIAVE = ChiaveTitolo;\r\n\t      INSERT INTO movimenti_magazzino_volante (DATA,TITOLO,QUANTITA,DESCRIZIONE)VALUES(NOW(),ChiaveTitolo,0,'Quantita volante azzerata da reset inventario');\r\n\t   END IF;\r\n\t\tIF OldQuantita <> 0 AND OldQuantitaVol <> 0 THEN\r\n\t\t   UPDATE titoli SET QUANTITA_MGZN = 0,QUANTITA_MGZN_VOL = 0 WHERE CHIAVE = ChiaveTitolo;\r\n\t      INSERT INTO movimenti_magazzino (DATA,TITOLO,QUANTITA,DESCRIZIONE)VALUES(NOW(),ChiaveTitolo,0,'Quantita azzerata da reset inventario');\r\n\t      INSERT INTO movimenti_magazzino_volante (DATA,TITOLO,QUANTITA,DESCRIZIONE)VALUES(NOW(),ChiaveTitolo,0,'Quantita volante azzerata da reset inventario');\r\n\t   END IF;\r\n\r\n\tEND LOOP GetTitoli;\r\n\t\r\n\tCLOSE CursoreTitoli;\r\n\r\nEND","Parametri":[]},{"Nome":"CLEAR_INVENTARIO_GRUPPO","Type":"PROCEDURE","ReturnType":null,"Body":"BEGIN\r\n\r\n\tDECLARE CicloFinito INTEGER DEFAULT 0;\r\n\tDECLARE ChiaveTitolo INT;\r\n\tDECLARE OldQuantita INT;\r\n\tDECLARE OldQuantitaVol INT;\r\n\r\n\tDEClARE CursoreTitoli \r\n\t\tCURSOR FOR \r\n\t\t\tSELECT CHIAVE,QUANTITA_MGZN,QUANTITA_MGZN_VOL FROM titoli WHERE (QUANTITA_MGZN <> 0 OR QUANTITA_MGZN_VOL <> 0) AND EDITORE IN (SELECT DESCRIZIONE FROM case_editrici WHERE GRUPPO = ChiaveEditore);\r\n\r\n\tDECLARE CONTINUE HANDLER \r\n        FOR NOT FOUND SET CicloFinito = 1;\r\n\r\n\tOPEN CursoreTitoli;\r\n\r\n\tGetTitoli: LOOP\r\n\t\tFETCH CursoreTitoli INTO ChiaveTitolo,OldQuantita,OldQuantitaVol;\r\n\t\tIF CicloFinito = 1 THEN \r\n\t\t\tLEAVE GetTitoli;\r\n\t\tEND IF;\r\n\t\t\r\n\t   IF OldQuantita <> 0 AND OldQuantitaVol = 0 THEN\r\n\t\t   UPDATE titoli SET QUANTITA_MGZN = 0  WHERE CHIAVE = ChiaveTitolo AND EDITORE IN (SELECT DESCRIZIONE FROM case_editrici WHERE GRUPPO = ChiaveEditore);\r\n\t\t   INSERT INTO movimenti_magazzino (DATA,TITOLO,QUANTITA,DESCRIZIONE)VALUES(NOW(),ChiaveTitolo,0,'Quantita azzerata da reset inventario');\r\n      END IF;\r\n\t   IF OldQuantita = 0 AND OldQuantitaVol <> 0 THEN\r\n\t      UPDATE titoli SET QUANTITA_MGZN_VOL = 0  WHERE CHIAVE = ChiaveTitolo AND EDITORE IN (SELECT DESCRIZIONE FROM case_editrici WHERE GRUPPO = ChiaveEditore);\r\n\t      INSERT INTO movimenti_magazzino_volante (DATA,TITOLO,QUANTITA,DESCRIZIONE)VALUES(NOW(),ChiaveTitolo,0,'Quantita volante azzerata da reset inventario');\r\n\t   END IF;\r\n\t\tIF OldQuantita <> 0 AND OldQuantitaVol <> 0 THEN\r\n\t\t   UPDATE titoli SET QUANTITA_MGZN = 0,QUANTITA_MGZN_VOL = 0 WHERE CHIAVE = ChiaveTitolo AND EDITORE IN (SELECT DESCRIZIONE FROM case_editrici WHERE GRUPPO = ChiaveEditore);\r\n\t      INSERT INTO movimenti_magazzino (DATA,TITOLO,QUANTITA,DESCRIZIONE)VALUES(NOW(),ChiaveTitolo,0,'Quantita azzerata da reset inventario');\r\n\t      INSERT INTO movimenti_magazzino_volante (DATA,TITOLO,QUANTITA,DESCRIZIONE)VALUES(NOW(),ChiaveTitolo,0,'Quantita volante azzerata da reset inventario');\r\n\t   END IF;\r\n\r\n\tEND LOOP GetTitoli;\r\n\t\r\n\tCLOSE CursoreTitoli;\r\n\r\nEND","Parametri":[{"Nome":"ChiaveEditore","Mode":"IN","Type":"int(11)"}]},{"Nome":"DELETE_ALL_PRENOTATI","Type":"PROCEDURE","ReturnType":null,"Body":"BEGIN\r\n\r\n  DECLARE CountTitoli INT;\r\n\r\n  DELETE \r\n    FROM dettaglio_spedizioni \r\n\tWHERE dettaglio_spedizioni.SPEDIZIONE = ChiaveSpedizione \r\n\t  AND dettaglio_spedizioni.STATO = 'P'; \r\n  \r\n  SELECT COUNT(*) INTO CountTitoli\r\n    FROM dettaglio_spedizioni \r\n\tWHERE dettaglio_spedizioni.SPEDIZIONE = ChiaveSpedizione;\r\n\t\r\n\tIF CountTitoli = 0 THEN\r\n\t   DELETE FROM spedizioni WHERE CHIAVE = ChiaveSpedizione;\r\n\tEND IF;\r\n\r\nEND","Parametri":[{"Nome":"ChiaveSpedizione","Mode":"IN","Type":"int(11)"}]},{"Nome":"DELETE_CARICO","Type":"PROCEDURE","ReturnType":null,"Body":"BEGIN\r\n  DECLARE OldNovitaCaricate INT;\r\n  DECLARE OldNovitaPrenotate INT;\r\n  \r\n  SELECT PRENOTAZ_NOVITA FROM titoli WHERE CHIAVE = TitoloCarico INTO OldNovitaPrenotate;\r\n  SELECT NOVITA_CARICATE FROM titoli WHERE CHIAVE = TitoloCarico INTO OldNovitaCaricate;\r\n\r\n  DELETE FROM ordini_ingresso WHERE CHIAVE = ChiaveCarico;\r\n\r\n  IF QuantitaCarico <= OldNovitaCaricate THEN\r\n     UPDATE titoli SET NOVITA_CARICATE = OldNovitaCaricate - QuantitaCarico,PRENOTAZ_NOVITA = OldNovitaPrenotate + QuantitaCarico WHERE CHIAVE = TitoloCarico;\r\n  ELSE UPDATE titoli SET NOVITA_CARICATE = 0, PRENOTAZ_NOVITA = OldNovitaPrenotate + OldNovitaCaricate WHERE CHIAVE = TitoloCarico;        \r\n  END IF;\r\n\r\nEND","Parametri":[{"Nome":"ChiaveCarico","Mode":"IN","Type":"int(11)"},{"Nome":"TitoloCarico","Mode":"IN","Type":"int(11)"},{"Nome":"QuantitaCarico","Mode":"IN","Type":"int(11)"}]},{"Nome":"EMPTY_ADOZIONI_ALL","Type":"PROCEDURE","ReturnType":null,"Body":"BEGIN\r\n DELETE FROM adozioni_titolo;\r\n DELETE FROM istituti_x_titoli;\r\nEND","Parametri":[]},{"Nome":"ERASE_ALL","Type":"PROCEDURE","ReturnType":null,"Body":"BEGIN\r\n DELETE FROM istituti_x_titoli;\r\n DELETE FROM istituti_x_docenti;\r\n DELETE FROM istituti;\r\n DELETE FROM insegnamenti_docente;\r\n DELETE FROM titoli;\r\n DELETE FROM docenti;\r\n DELETE FROM materie_insegnamento;\r\n DELETE FROM tipologie_istituto;\r\nEND","Parametri":[]},{"Nome":"ERASE_CLASSI","Type":"PROCEDURE","ReturnType":null,"Body":"BEGIN\r\n\r\n  DELETE FROM insegnamenti_docente;\r\n  DELETE FROM adozioni_titolo;\r\n  DELETE FROM classi;\r\n\r\nEND","Parametri":[]},{"Nome":"GET_STATISTICA_PROMOTORI","Type":"PROCEDURE","ReturnType":null,"Body":"BEGIN\r\n\tSELECT titoli.CODICE_ISBN,\r\n\t       titoli.PREZZO,\r\n\t       titoli.TITOLO,\r\n\t       istituti.CHIAVE AS CHIAVE_ISTITUTO,\r\n\t       istituti.NOME AS NOME_ISTITUTO,\r\n\t       istituti.PROMOTORE,\r\n\t       utenti.RAGIONE_SOCIALE,\r\n\t       COUNT(*) AS NUMERO_ADOZIONI_X_ISTITUTO,\r\n\t       configurazione_ditta.NR_ALUNNI\r\n\t  FROM adozioni_titolo,titoli,classi,istituti,utenti,configurazione_ditta\r\n\t WHERE adozioni_titolo.TITOLO = titoli.CHIAVE\r\n\t   AND adozioni_titolo.CLASSE = classi.CHIAVE\r\n\t   AND titoli.EDITORE IN (SELECT DESCRIZIONE\r\n\t                            FROM case_editrici) \r\n\t   AND classi.ISTITUTO = istituti.CHIAVE\r\n\t   AND utenti.ELIMINATO <> 1\r\n\t   AND adozioni_titolo.CLASSE IN  (SELECT insegnamenti_docente.CLASSE\r\n\t\t\t\t                            FROM insegnamenti_docente\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tWHERE insegnamenti_docente.DOCENTE IN (SELECT spedizioni.DOCENTE\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t                                         FROM spedizioni\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t WHERE spedizioni.PROMOTORE = utenti.CHIAVE \r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   AND spedizioni.CHIAVE IN (SELECT dettaglio_spedizioni.SPEDIZIONE\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t                               FROM dettaglio_spedizioni\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tWHERE dettaglio_spedizioni.STATO = 'C'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  AND dettaglio_spedizioni.TITOLO = titoli.CHIAVE\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  AND dettaglio_spedizioni.DATA_ULTIMA_MODIFICA >= DataDal \r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  AND dettaglio_spedizioni.DATA_ULTIMA_MODIFICA <= DataAl)))\r\n\t\r\n\tGROUP BY adozioni_titolo.TITOLO,istituti.CHIAVE\r\n\tORDER BY utenti.RAGIONE_SOCIALE,istituti.NOME,titoli.TITOLO;\r\n\r\nEND","Parametri":[{"Nome":"DataDal","Mode":"IN","Type":"date"},{"Nome":"DataAl","Mode":"IN","Type":"date"}]},{"Nome":"INSERT_CARICO","Type":"PROCEDURE","ReturnType":null,"Body":"BEGIN\r\n  DECLARE NewKey INT;\r\n  DECLARE QuantitaNovita INT;\r\n  DECLARE QuantitaNovitaToAdd INT;\r\n  \r\n  UPDATE gen_key SET CHIAVE = CHIAVE + 1;  \r\n  SELECT MAX(CHIAVE) FROM gen_key INTO NewKey;\r\n  SELECT PRENOTAZ_NOVITA FROM titoli WHERE CHIAVE = TitoloCarico INTO QuantitaNovita;\r\n\r\n  INSERT INTO ordini_ingresso (CHIAVE,DATA,TITOLO,QUANTITA,UBICAZIONE) VALUES (NewKey,DataCarico,TitoloCarico,QuantitaCarico,UbicazioneCarico);   \r\n\r\n  IF QuantitaNovita > 0 THEN\r\n     IF QuantitaCarico <= QuantitaNovita THEN\r\n        SET QuantitaNovitaToAdd := QuantitaCarico;\r\n     ELSE SET QuantitaNovitaToAdd := QuantitaNovita;\r\n     END IF;\r\n     \r\n\t  UPDATE titoli SET PRENOTAZ_NOVITA = PRENOTAZ_NOVITA - QuantitaNovitaToAdd,NOVITA_CARICATE = NOVITA_CARICATE + QuantitaNovitaToAdd WHERE CHIAVE = TitoloCarico;\r\n  END IF;\r\n  \r\nEND","Parametri":[{"Nome":"DataCarico","Mode":"IN","Type":"date"},{"Nome":"TitoloCarico","Mode":"IN","Type":"int(11)"},{"Nome":"QuantitaCarico","Mode":"IN","Type":"int(11)"},{"Nome":"UbicazioneCarico","Mode":"IN","Type":"varchar(255)"}]},{"Nome":"LYBRO_AGGIORNA_ISTITUTI","Type":"PROCEDURE","ReturnType":null,"Body":"BEGIN\r\n  DECLARE NewKey INT;\r\n      \r\n  IF (SELECT count(*) FROM istituti WHERE CODICE = CodiceIstituto) > 0 THEN\r\n      UPDATE istituti \r\n\t\t   SET NOME = NomeIstituto,INDIRIZZO = IndirizzoIstituto,PROVINCIA = ProvinciaIstituto,COMUNE = ComuneIstituto,CAP = CapIstituto,EMAIL = EmailIstituto,SITO_WEB = SitoWebIstituto,PRESIDE = PresideIstituto,VICEPRESIDE = VicePresIstituto,DIR_AMMNSTR = DirAmmIstituto,TELEFONO_1 = Telefono1,REFERENTE_1 = Referente1,TELEFONO_2 = Telefono2,REFERENTE_2 = Referente2,TELEFONO_3 = Telefono3,REFERENTE_3 = Referente3  WHERE CODICE = CodiceIstituto;\r\n  ELSE\r\n      UPDATE gen_key SET CHIAVE = CHIAVE + 1;\r\n      SELECT MAX(CHIAVE) FROM gen_key INTO NewKey; \r\n      INSERT INTO istituti (CHIAVE,CODICE,NOME,INDIRIZZO,PROVINCIA,COMUNE,CAP,EMAIL,SITO_WEB,PRESIDE,VICEPRESIDE,DIR_AMMNSTR,TELEFONO_1,REFERENTE_1,TELEFONO_2,REFERENTE_2,TELEFONO_3,REFERENTE_3) VALUES (NewKey,CodiceIstituto,NomeIstituto,IndirizzoIstituto,ProvinciaIstituto,ComuneIstituto,CapIstituto,EmailIstituto,SitoWebIstituto,PresideIstituto,VicePresIstituto,DirAmmIstituto,Telefono1,Referente1,Telefono2,Referente2,Telefono3,Referente3); \r\n  END IF;\r\n  \r\n  INSERT IGNORE INTO istituti_x_docenti (DOCENTE,ISTITUTO) VALUES ((SELECT docenti.CHIAVE FROM docenti WHERE LYBRO_KEY = DocenteLybro),(SELECT istituti.CHIAVE FROM istituti WHERE istituti.CODICE = CodiceIstituto)); \r\n  \r\nEND","Parametri":[{"Nome":"CodiceIstituto","Mode":"IN","Type":"varchar(255)"},{"Nome":"NomeIstituto","Mode":"IN","Type":"varchar(255)"},{"Nome":"IndirizzoIstituto","Mode":"IN","Type":"varchar(255)"},{"Nome":"ProvinciaIstituto","Mode":"IN","Type":"int(11)"},{"Nome":"ComuneIstituto","Mode":"IN","Type":"varchar(255)"},{"Nome":"CapIstituto","Mode":"IN","Type":"varchar(255)"},{"Nome":"EmailIstituto","Mode":"IN","Type":"varchar(255)"},{"Nome":"SitoWebIstituto","Mode":"IN","Type":"varchar(255)"},{"Nome":"PresideIstituto","Mode":"IN","Type":"varchar(255)"},{"Nome":"VicePresIstituto","Mode":"IN","Type":"varchar(255)"},{"Nome":"DirAmmIstituto","Mode":"IN","Type":"varchar(255)"},{"Nome":"Telefono1","Mode":"IN","Type":"varchar(255)"},{"Nome":"Referente1","Mode":"IN","Type":"varchar(255)"},{"Nome":"Telefono2","Mode":"IN","Type":"varchar(255)"},{"Nome":"Referente2","Mode":"IN","Type":"varchar(255)"},{"Nome":"Telefono3","Mode":"IN","Type":"varchar(255)"},{"Nome":"Referente3","Mode":"IN","Type":"varchar(255)"},{"Nome":"DocenteLybro","Mode":"IN","Type":"int(11)"}]},{"Nome":"MAIL_FROM_MAILCHIMP","Type":"PROCEDURE","ReturnType":null,"Body":"BEGIN\r\n\r\nDECLARE ChiaveDocente INT;\r\nDECLARE DocentiOmonimi INT;\r\nDECLARE KeyDocente INT;\r\n\r\nSELECT COUNT(*) FROM docenti WHERE UPPER(RAGIONE_SOCIALE) = UPPER(NomeDocente) INTO DocentiOmonimi;\r\nSELECT CHIAVE FROM docenti WHERE UPPER(RAGIONE_SOCIALE) = UPPER(NomeDocente) LIMIT 1 INTO ChiaveDocente;\r\n\r\nIF ChiaveDocente IS NULL AND DocentiOmonimi = 0 THEN \r\n   BEGIN\r\n      INSERT INTO log_mailchimp (RAGIONE_SOCIALE,MAIL,CHIAVE_DOC,DATA)VALUES(NomeDocente,MailDocente,NULL,NOW());\r\n      \r\n      UPDATE gen_key SET CHIAVE = CHIAVE + 1;\r\n      SELECT MAX(CHIAVE) FROM gen_key INTO KeyDocente; \r\n      INSERT INTO docenti (CHIAVE,RAGIONE_SOCIALE,EMAIL) VALUES (KeyDocente,NomeDocente,MailDocente);  \r\n   END; \r\nELSEIF ChiaveDocente IS NOT NULL AND DocentiOmonimi < 2 THEN\r\n        INSERT INTO log_mailchimp (RAGIONE_SOCIALE,MAIL,CHIAVE_DOC,DATA)VALUES(NomeDocente,MailDocente,ChiaveDocente,NOW());\r\n        UPDATE docenti SET EMAIL = MailDocente WHERE CHIAVE = ChiaveDocente;\r\nELSE INSERT INTO log_mailchimp (RAGIONE_SOCIALE,MAIL,CHIAVE_DOC,DATA)VALUES(NomeDocente,MailDocente,0,NOW());\r\nEND IF;\r\n\r\nEND","Parametri":[{"Nome":"MailDocente","Mode":"IN","Type":"varchar(255)"},{"Nome":"NomeDocente","Mode":"IN","Type":"varchar(255)"}]},{"Nome":"MATERIE_FROM_LYBRO","Type":"PROCEDURE","ReturnType":null,"Body":"BEGIN\r\n  DECLARE KeyMateria INT;    \r\n  DECLARE MateriaUno INT;\r\n  DECLARE MateriaDue INT;\r\n  DECLARE MateriaTre INT;\r\n  \r\n  SELECT MAX(CHIAVE)\r\n    FROM materie_insegnamento \r\n\tWHERE UPPER(DESCRIZIONE) = MateriaLybro \r\n\t INTO KeyMateria;\r\n  \r\n  IF KeyMateria IS NULL THEN\r\n     UPDATE gen_key SET CHIAVE = CHIAVE + 1;\r\n     SELECT MAX(CHIAVE) FROM gen_key INTO KeyMateria; \r\n     INSERT INTO materie_insegnamento(CHIAVE,DESCRIZIONE) VALUES (KeyMateria,MateriaLybro);\r\n  END IF;\r\n  \r\n  SELECT docenti.MATERIA_1,docenti.MATERIA_2,docenti.MATERIA_3 INTO MateriaUno,MateriaDue,MateriaTre FROM docenti WHERE LYBRO_KEY = DocenteLKey;\r\n\r\n  IF MateriaUno IS NULL THEN\r\n     SET MateriaUno := 0;\r\n  END IF;\r\n\r\n  IF MateriaDue IS NULL THEN\r\n     SET MateriaDue := 0;\r\n  END IF;\r\n\r\n  IF MateriaTre IS NULL THEN\r\n     SET MateriaTre := 0;\r\n  END IF;\r\n\r\n  IF (KeyMateria <> MateriaUno AND KeyMateria <> MateriaDue AND KeyMateria <> MateriaTre) THEN \r\n      IF MateriaUno = 0 THEN UPDATE docenti SET MATERIA_1 = KeyMateria WHERE LYBRO_KEY = DocenteLKey;\r\n      ELSEIF MateriaDue = 0 THEN UPDATE docenti SET MATERIA_2 = KeyMateria WHERE LYBRO_KEY = DocenteLKey;\r\n      ELSE UPDATE docenti SET MATERIA_3 = KeyMateria WHERE LYBRO_KEY = DocenteLKey;\r\n      END IF;\r\n  END IF;\r\n\r\nEND","Parametri":[{"Nome":"MateriaLybro","Mode":"IN","Type":"varchar(255)"},{"Nome":"DocenteLKey","Mode":"IN","Type":"varchar(255)"}]},{"Nome":"UNISCI_NASCONDI_ISTITUTI","Type":"PROCEDURE","ReturnType":null,"Body":"BEGIN\r\n\r\n  DELETE FROM docenti_disponibilita WHERE ISTITUTO = OldIstituto;\r\n  DELETE FROM insegnamenti_docente WHERE CLASSE IN (SELECT CHIAVE FROM classi WHERE ISTITUTO = OldIstituto);   \r\n  UPDATE IGNORE istituti_x_docenti SET ISTITUTO = NewIstituto WHERE ISTITUTO = OldIstituto;\r\n  DELETE FROM istituti_x_docenti WHERE ISTITUTO = OldIstituto;\r\n  UPDATE istituti SET NASCOSTO = 1 WHERE CHIAVE = OldIstituto;\r\n\r\nEND","Parametri":[{"Nome":"OldIstituto","Mode":"IN","Type":"int(11)"},{"Nome":"NewIstituto","Mode":"IN","Type":"int(11)"}]},{"Nome":"UNISCI_NASCONDI_MATERIA","Type":"PROCEDURE","ReturnType":null,"Body":"BEGIN   \r\n   UPDATE titoli      \r\n      SET MATERIA = MateriaNew    \r\n    WHERE MATERIA = MateriaOld;     \r\n   \r\n   UPDATE docenti      \r\n      SET MATERIA_1 = MateriaNew    \r\n    WHERE MATERIA_1 = MateriaOld;    \r\n    \r\n    UPDATE docenti      \r\n       SET MATERIA_2 = MateriaNew    \r\n     WHERE MATERIA_2 = MateriaOld;     \r\n     \r\n    UPDATE docenti      \r\n       SET MATERIA_3 = MateriaNew    \r\n     WHERE MATERIA_3 = MateriaOld;     \r\n     \r\n    DELETE \r\n      FROM materie_istituti \r\n     WHERE MATERIA = MateriaOld;\r\n\t  \r\n\t   \/*DROP TABLE IF EXISTS MAT_IST_TMP;  \r\n      \r\n    CREATE TABLE MAT_IST_TMP SELECT * \r\n                               FROM materie_istituti   \r\n                              WHERE MATERIA = MateriaOld; \r\n\r\n    DELETE \r\n      FROM materie_istituti \r\n     WHERE MATERIA = MateriaOld;  \r\n     \r\n    UPDATE MAT_IST_TMP\r\n       SET MATERIA = MateriaNew;  \r\n       \r\n    INSERT IGNORE INTO materie_istituti (MATERIA,GRUPPO_IST) SELECT MATERIA,GRUPPO_IST\r\n                                                               FROM MAT_IST_TMP;  \r\n                                                                              \r\n      DROP TABLE MAT_IST_TMP; *\/\t\t   \r\n     \r\n      DROP TABLE IF EXISTS INS_DOC_TMP;  \r\n      \r\n    CREATE TABLE INS_DOC_TMP SELECT * \r\n                               FROM insegnamenti_docente   \r\n                              WHERE MATERIA = MateriaOld; \r\n\r\n    DELETE \r\n      FROM insegnamenti_docente \r\n     WHERE MATERIA = MateriaOld;  \r\n     \r\n    UPDATE INS_DOC_TMP\r\n       SET MATERIA = MateriaNew;  \r\n       \r\n    INSERT IGNORE INTO insegnamenti_docente (CHIAVE,MATERIA,CLASSE,DOCENTE) SELECT CHIAVE,MATERIA,CLASSE,DOCENTE  \r\n                                                                              FROM INS_DOC_TMP;  \r\n                                                                              \r\n      DROP TABLE INS_DOC_TMP;    \r\n\r\n    UPDATE materie_insegnamento      \r\n       SET NASCOSTA = 1  \r\n     WHERE CHIAVE = MateriaOld;    \r\n            \r\nEND","Parametri":[{"Nome":"MateriaOld","Mode":"IN","Type":"int(11)"},{"Nome":"MateriaNew","Mode":"IN","Type":"int(11)"}]},{"Nome":"UPDATE_CARICO","Type":"PROCEDURE","ReturnType":null,"Body":"BEGIN \r\n  UPDATE ordini_ingresso \r\n     SET DATA=DataCarico,TITOLO=TitoloCarico,QUANTITA=QuantitaCarico,UBICAZIONE=UbicazioneCarico \r\n\tWHERE CHIAVE=ChiaveCarico;  \r\nEND","Parametri":[{"Nome":"ChiaveCarico","Mode":"IN","Type":"int(11)"},{"Nome":"DataCarico","Mode":"IN","Type":"date"},{"Nome":"TitoloCarico","Mode":"IN","Type":"int(11)"},{"Nome":"QuantitaCarico","Mode":"IN","Type":"int(11)"},{"Nome":"UbicazioneCarico","Mode":"IN","Type":"varchar(255)"}]},{"Nome":"UPDATE_INVENTARIO_TEMP","Type":"PROCEDURE","ReturnType":null,"Body":"BEGIN\r\n\r\n  INSERT INTO inventario_temporaneo (CODICE,QUANTITA_MGZN,QUANTITA_MGZN_VOL,UBICAZIONE)VALUES(CodiceTit,QTit,QVolTit,UbcznTit)\r\n  ON DUPLICATE KEY UPDATE QUANTITA_MGZN = QTit, QUANTITA_MGZN_VOL = QVolTit, UBICAZIONE = UbcznTit;\r\n\r\nEND","Parametri":[{"Nome":"CodiceTit","Mode":"IN","Type":"varchar(255)"},{"Nome":"QTit","Mode":"IN","Type":"int(11)"},{"Nome":"QVolTit","Mode":"IN","Type":"int(11)"},{"Nome":"UbcznTit","Mode":"IN","Type":"varchar(255)"}]},{"Nome":"UPDATE_TITOLI_FROM_INVENTARIO","Type":"PROCEDURE","ReturnType":null,"Body":"BEGIN\r\n\r\n  UPDATE titoli SET QUANTITA_MGZN = QuantitaTitolo, QUANTITA_MGZN_VOL = QuantitaVolanteTitolo, POS_MAGAZZINO = PosizioneMagazzinoTitolo \r\n   WHERE CHIAVE = ChiaveTitolo;\r\n  INSERT INTO movimenti_magazzino (DATA,TITOLO,QUANTITA,DESCRIZIONE)VALUES(NOW(),ChiaveTitolo,QuantitaTitolo,'Nuova quantita magazzino da inventario');\r\n  INSERT INTO movimenti_magazzino_volante (DATA,TITOLO,QUANTITA,DESCRIZIONE)VALUES(NOW(),ChiaveTitolo,QuantitaVolanteTitolo,'Nuova quantita magazzino volante da inventario');\r\n\r\nEND","Parametri":[{"Nome":"ChiaveTitolo","Mode":"IN","Type":"int(11)"},{"Nome":"QuantitaTitolo","Mode":"IN","Type":"int(11)"},{"Nome":"QuantitaVolanteTitolo","Mode":"IN","Type":"int(11)"},{"Nome":"PosizioneMagazzinoTitolo","Mode":"IN","Type":"varchar(255)"}]},{"Nome":"UPDATE_TITOLI_LOG_MAGAZZINI","Type":"PROCEDURE","ReturnType":null,"Body":"BEGIN\r\n \r\n  DECLARE OldQuantita INT;\r\n  DECLARE OldQuantitaVol INT;\r\n  \r\n  SELECT titoli.QUANTITA_MGZN,titoli.QUANTITA_MGZN_VOL \r\n    FROM titoli \r\n\tWHERE CHIAVE=ChiaveTitolo \r\n\t INTO OldQuantita,OldQuantitaVol;\r\n  \r\n  UPDATE titoli SET CODICE_ISBN=Codice,TITOLO=Titolo,MATERIA=Materia,AUTORI=Autori,EDITORE=Editore,VOLUME=Volume,POS_MAGAZZINO=PosMgzn,PREZZO=Prezzo,QUANTITA_MGZN=QuantitaMgzn,QUANTITA_MGZN_VOL=QuantitaMgznVol,PRENOTAZ_NOVITA=PrenotazNovita \r\n   WHERE CHIAVE=ChiaveTitolo;\r\n  IF QuantitaMgzn <> 0 THEN\r\n    INSERT INTO movimenti_magazzino (DATA,TITOLO,QUANTITA,DESCRIZIONE) VALUES (NOW(),ChiaveTitolo,QuantitaMgzn - OldQuantita,'Modificata quantita magazzino da titoli');\r\n  END IF;\r\n  IF QuantitaMgznVol <> 0 THEN\r\n    INSERT INTO movimenti_magazzino_volante (DATA,TITOLO,QUANTITA,DESCRIZIONE) VALUES (NOW(),ChiaveTitolo,QuantitaMgznVol - OldQuantitaVol,'Modificata quantita magazzino volante da titoli');\r\n  END IF;\r\nEND","Parametri":[{"Nome":"ChiaveTitolo","Mode":"IN","Type":"int(11)"},{"Nome":"Codice","Mode":"IN","Type":"varchar(255)"},{"Nome":"Titolo","Mode":"IN","Type":"varchar(255)"},{"Nome":"Materia","Mode":"IN","Type":"int(11)"},{"Nome":"Autori","Mode":"IN","Type":"varchar(255)"},{"Nome":"Editore","Mode":"IN","Type":"varchar(255)"},{"Nome":"Volume","Mode":"IN","Type":"int(11)"},{"Nome":"Prezzo","Mode":"IN","Type":"varchar(255)"},{"Nome":"PosMgzn","Mode":"IN","Type":"varchar(255)"},{"Nome":"QuantitaMgzn","Mode":"IN","Type":"int(11)"},{"Nome":"QuantitaMgznVol","Mode":"IN","Type":"int(11)"},{"Nome":"PrenotazNovita","Mode":"IN","Type":"int(11)"}]}],"__CommentCampiDaEliminare":"Vettore di oggetti con Campo e Tabella","CampiDaEliminare":[{"Campo":"GIORNO","Tabella":"insegnamenti_docente"},{"Campo":"ORARIO","Tabella":"insegnamenti_docente"},{"Campo":"DA","Tabella":"docenti_disponibilita"},{"Campo":"A","Tabella":"docenti_disponibilita"},{"Campo":"POSIZIONE","Tabella":"docenti_disponibilita"},{"Campo":"SOTTOTITOLO","Tabella":"titoli"}],"__CommentTabelleDaEliminare":"Vettore di stringhe con i nomi delle tabelle","TabelleDaEliminare":[],"__CommentQueryAllCreazione":"Vettore di stringhe contenente la lista di query","QryOnDBaseCreation":["INSERT INTO `utenti` (`CHIAVE`, `USERNAME`, `RAGIONE_SOCIALE`, `PASSWORD`, `EMAIL`, `ROLE`, `ELIMINATO`) VALUES (1, 'admin', 'admin', '', '', 1, b'0')","INSERT INTO `configurazione_ditta` (`INDIRIZZO`, `EMAIL`, `SITO_WEB`, `TELEFONO`) VALUES ('', '', '', '')","INSERT INTO `province` (`CHIAVE`, `NOME`) VALUES (1, 'LA SPEZIA'), (2, 'SAVONA'),(3, 'GENOVA'),(4, 'ALESSANDRIA')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73818, 'AGRIGENTO')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73819, 'ALESSANDRIA')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73820, 'ANCONA')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73821, 'AOSTA')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73822, 'L\\'AQUILA')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73823, 'AREZZO')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73824, 'ASCOLI-PICENO')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73825, 'ASTI')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73826, 'AVELLINO')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73827, 'BARI')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73828, 'BARLETTA-ANDRIA-TRANI')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73829, 'BELLUNO')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73830, 'BENEVENTO')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73831, 'BERGAMO')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73832, 'BIELLA')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73833, 'BOLOGNA')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73834, 'BOLZANO')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73835, 'BRESCIA')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73836, 'BRINDISI')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73837, 'CAGLIARI')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73838, 'CALTANISSETTA')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73839, 'CAMPOBASSO')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73840, 'CARBONIA IGLESIAS')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73841, 'CASERTA')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73842, 'CATANIA')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73843, 'CATANZARO')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73844, 'CHIETI')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73845, 'COMO')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73846, 'COSENZA')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73847, 'CREMONA')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73848, 'CROTONE')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73849, 'CUNEO')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73850, 'ENNA')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73851, 'FERMO')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73852, 'FERRARA')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73853, 'FIRENZE')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73854, 'FOGGIA')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73855, 'FORLI-CESENA')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73856, 'FROSINONE')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73857, 'GENOVA')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73858, 'GORIZIA')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73859, 'GROSSETO')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73860, 'IMPERIA')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73861, 'ISERNIA')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73862, 'LA SPEZIA')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73863, 'LATINA')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73864, 'LECCE')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73865, 'LECCO')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73866, 'LIVORNO')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73867, 'LODI')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73868, 'LUCCA')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73869, 'MACERATA')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73870, 'MANTOVA')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73871, 'MASSA CARRARA')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73872, 'MATERA')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73873, 'MEDIO CAMPIDANO')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73874, 'MESSINA')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73875, 'MILANO')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73876, 'MODENA')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73877, 'MONZA-BRIANZA')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73878, 'NAPOLI')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73879, 'NOVARA')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73880, 'NUORO')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73881, 'OGLIASTRA')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73882, 'OLBIA TEMPIO')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73883, 'ORISTANO')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73884, 'PADOVA')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73885, 'PALERMO')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73886, 'PARMA')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73887, 'PAVIA')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73888, 'PERUGIA')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73889, 'PESARO-URBINO')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73890, 'PESCARA')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73891, 'PIACENZA')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73892, 'PISA')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73893, 'PISTOIA')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73894, 'PORDENONE')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73895, 'POTENZA')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73896, 'PRATO')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73897, 'RAGUSA')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73898, 'RAVENNA')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73899, 'REGGIO-CALABRIA')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73900, 'REGGIO-EMILIA')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73901, 'RIETI')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73902, 'RIMINI')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73903, 'ROMA')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73904, 'ROVIGO')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73905, 'SALERNO')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73906, 'SASSARI')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73907, 'SAVONA')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73908, 'SIENA')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73909, 'SIRACUSA')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73910, 'SONDRIO')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73911, 'TARANTO')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73912, 'TERAMO')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73913, 'TERNI')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73914, 'TORINO')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73915, 'TRAPANI')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73916, 'TRENTO')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73917, 'TREVISO')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73918, 'TRIESTE')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73919, 'UDINE')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73920, 'VARESE')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73921, 'VENEZIA')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73922, 'VERBANIA')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73923, 'VERCELLI')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73924, 'VERONA')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73925, 'VIBO-VALENTIA')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73926, 'VICENZA')","INSERT INTO `province_all` (`CHIAVE`, `NOME`) VALUES (73927, 'VITERBO')"]}